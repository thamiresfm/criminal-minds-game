<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Corre√ß√£o de Erros</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            margin: 0;
            padding: 20px;
            color: white;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 2rem;
            backdrop-filter: blur(10px);
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .test-title {
            color: #fbbf24;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .test-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #fbbf24;
            color: #1f2937;
        }
        
        .btn-primary:hover {
            background: #f59e0b;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .debug-panel {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .debug-title {
            color: #fbbf24;
            margin-bottom: 0.5rem;
        }
        
        .debug-log {
            background: rgba(0, 0, 0, 0.3);
            padding: 0.5rem;
            margin: 0.25rem 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.8rem;
        }
        
        .error-log {
            background: rgba(239, 68, 68, 0.2);
            border-left: 3px solid #ef4444;
        }
        
        .success-log {
            background: rgba(16, 185, 129, 0.2);
            border-left: 3px solid #10b981;
        }
        
        .stats-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .stat-card {
            background: rgba(0, 0, 0, 0.2);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #fbbf24;
        }
        
        .stat-label {
            color: #9ca3af;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üîß Teste - Corre√ß√£o de Erros</h1>
            <p>Verificando se os erros foram corrigidos no sistema</p>
        </div>
        
        <!-- Se√ß√£o de Estat√≠sticas -->
        <div class="test-section">
            <h2 class="test-title">üìä Estat√≠sticas do Sistema</h2>
            <div class="stats-display">
                <div class="stat-card">
                    <div class="stat-value" id="cardsPlayed">0/6</div>
                    <div class="stat-label">üÉè Cartas Jogadas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="comboStreak">0x</div>
                    <div class="stat-label">üî• Combo Streak</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="currentMultiplier">1.0x</div>
                    <div class="stat-label">üìà Multiplicador</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="evidenceDisplay">0/100</div>
                    <div class="stat-label">üîç Evid√™ncias</div>
                </div>
            </div>
        </div>
        
        <!-- Se√ß√£o de Testes -->
        <div class="test-section">
            <h2 class="test-title">üß™ Testes de Corre√ß√£o</h2>
            <div class="test-buttons">
                <button class="btn btn-primary" onclick="testComboStreak()">üî• Testar Combo Streak</button>
                <button class="btn btn-secondary" onclick="testNotifications()">üîî Testar Notifica√ß√µes</button>
                <button class="btn btn-success" onclick="testAchievements()">üèÜ Testar Conquistas</button>
                <button class="btn btn-danger" onclick="testErrorHandling()">‚ùå Testar Tratamento de Erros</button>
            </div>
        </div>
        
        <!-- Se√ß√£o de Verifica√ß√£o -->
        <div class="test-section">
            <h2 class="test-title">‚úÖ Verifica√ß√£o de Corre√ß√µes</h2>
            <div class="test-buttons">
                <button class="btn btn-primary" onclick="checkFunctionDefinitions()">üîç Verificar Fun√ß√µes</button>
                <button class="btn btn-secondary" onclick="checkElementReferences()">üéØ Verificar Elementos</button>
                <button class="btn btn-success" onclick="checkVariableScope()">üì¶ Verificar Vari√°veis</button>
                <button class="btn btn-danger" onclick="runFullDiagnostic()">üî¨ Diagn√≥stico Completo</button>
            </div>
        </div>
        
        <!-- Painel de Debug -->
        <div class="test-section">
            <h2 class="test-title">üêõ Painel de Debug</h2>
            <div class="debug-panel" id="debugPanel">
                <div class="debug-title">Log de Eventos:</div>
                <div class="debug-log">Sistema de teste inicializado. Pronto para verificar corre√ß√µes.</div>
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais do jogo
        let cardsPlayed = 0;
        let comboStreak = 0;
        let currentEvidence = 0;
        const maxEvidence = 100;
        const maxCardsForLevel = 6;
        
        // Simula√ß√£o do banco de dados de cartas
        const cardDatabase = [
            {
                id: 'test_card_1',
                title: 'Carta de Teste 1',
                type: 'Teste',
                rarity: 'common',
                icon: 'üß™',
                evidence: 20,
                played: false
            }
        ];
        
        // Simula√ß√£o das configura√ß√µes de dificuldade
        const difficultySettings = {
            beginner: { cards: 6, name: 'Iniciante', color: '#10b981' },
            intermediate: { cards: 20, name: 'Intermedi√°rio', color: '#f59e0b' },
            hard: { cards: 25, name: 'Dif√≠cil', color: '#ef4444' }
        };
        
        let currentDifficulty = 'beginner';
        
        // Simula√ß√£o das conquistas
        const achievements = {
            comboMaster: {
                id: 'comboMaster',
                title: 'Combo Master',
                message: 'Alcan√ßou um combo de 10x!',
                reward: 100,
                completed: false
            }
        };
        
        // Fun√ß√£o para adicionar log de debug
        function addDebug(message, type = 'info') {
            const debugPanel = document.getElementById('debugPanel');
            const logEntry = document.createElement('div');
            logEntry.className = `debug-log ${type}-log`;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            debugPanel.appendChild(logEntry);
            debugPanel.scrollTop = debugPanel.scrollHeight;
        }
        
        // Fun√ß√£o para mostrar notifica√ß√£o
        function showNotification(message) {
            addDebug(`üîî Notifica√ß√£o: ${message}`, 'success');
        }
        
        // Fun√ß√£o para desbloquear conquista
        function unlockAchievement(achievementId) {
            const achievement = achievements[achievementId];
            if (achievement && !achievement.completed) {
                achievement.completed = true;
                addDebug(`üèÜ Conquista desbloqueada: ${achievement.title}`, 'success');
                showNotification(`üèÜ CONQUISTA DESBLOQUEADA!\n${achievement.message}`);
            }
        }
        
        // Fun√ß√£o para gerenciar o Combo Streak (vers√£o corrigida)
        function manageComboStreak(action = 'increment') {
            addDebug(`üî• Gerenciando Combo Streak: ${action}`);
            
            try {
                switch (action) {
                    case 'increment':
                        comboStreak++;
                        addDebug(`üî• Combo incrementado: ${comboStreak}x`, 'success');
                        
                        // Verificar conquistas de combo
                        if (comboStreak === 3) {
                            showNotification('üî• Combo 3x! B√¥nus de evid√™ncias ativo!');
                        } else if (comboStreak === 5) {
                            showNotification('‚ö° Combo 5x! Multiplicador m√°ximo!');
                        } else if (comboStreak === 10) {
                            showNotification('üéØ Combo 10x! LEND√ÅRIO!');
                            unlockAchievement('comboMaster');
                        }
                        break;
                        
                    case 'reset':
                        const previousCombo = comboStreak;
                        comboStreak = 0;
                        addDebug(`üî• Combo resetado: ${previousCombo}x ‚Üí 0x`, 'success');
                        
                        if (previousCombo >= 3) {
                            showNotification('üíî Combo perdido! Volte a jogar cartas consecutivamente.');
                        }
                        break;
                        
                    case 'maintain':
                        addDebug(`üî• Combo mantido: ${comboStreak}x`, 'success');
                        break;
                        
                    default:
                        addDebug(`‚ùå A√ß√£o de combo inv√°lida: ${action}`, 'error');
                        return;
                }
                
                updateComboDisplay();
                updateMultiplier();
                updateComboProgressBar();
                
                addDebug(`‚úÖ Combo Streak gerenciado com sucesso: ${comboStreak}x`, 'success');
                return comboStreak;
                
            } catch (error) {
                addDebug(`‚ùå Erro no manageComboStreak: ${error.message}`, 'error');
                console.error('Erro no manageComboStreak:', error);
            }
        }
        
        // Fun√ß√£o para atualizar o display do combo
        function updateComboDisplay() {
            try {
                const comboElement = document.getElementById('comboStreak');
                if (comboElement) {
                    comboElement.textContent = `${comboStreak}x`;
                    addDebug(`üî• Display do combo atualizado: ${comboStreak}x`, 'success');
                } else {
                    addDebug('‚ùå Elemento comboStreak n√£o encontrado', 'error');
                }
            } catch (error) {
                addDebug(`‚ùå Erro no updateComboDisplay: ${error.message}`, 'error');
            }
        }
        
        // Fun√ß√£o para atualizar o multiplicador
        function updateMultiplier() {
            try {
                const multiplier = 1.0 + (comboStreak * 0.1);
                const multiplierElement = document.getElementById('currentMultiplier');
                
                if (multiplierElement) {
                    multiplierElement.textContent = `${multiplier.toFixed(1)}x`;
                    addDebug(`üìà Multiplicador atualizado: ${multiplier.toFixed(1)}x`, 'success');
                } else {
                    addDebug('‚ùå Elemento currentMultiplier n√£o encontrado', 'error');
                }
                
                return multiplier;
            } catch (error) {
                addDebug(`‚ùå Erro no updateMultiplier: ${error.message}`, 'error');
            }
        }
        
        // Fun√ß√£o para atualizar a barra de progresso do combo
        function updateComboProgressBar() {
            try {
                const maxCombo = 10;
                const progressPercentage = Math.min((comboStreak / maxCombo) * 100, 100);
                addDebug(`üìä Barra de progresso do combo: ${progressPercentage.toFixed(1)}%`, 'success');
            } catch (error) {
                addDebug(`‚ùå Erro no updateComboProgressBar: ${error.message}`, 'error');
            }
        }
        
        // Fun√ß√µes de teste
        function testComboStreak() {
            addDebug('üß™ Testando sistema de Combo Streak...', 'info');
            
            // Teste 1: Incremento
            manageComboStreak('increment');
            
            // Teste 2: Incremento m√∫ltiplo
            setTimeout(() => {
                manageComboStreak('increment');
                manageComboStreak('increment');
                manageComboStreak('increment');
            }, 500);
            
            // Teste 3: Reset
            setTimeout(() => {
                manageComboStreak('reset');
            }, 1500);
            
            addDebug('‚úÖ Teste de Combo Streak conclu√≠do', 'success');
        }
        
        function testNotifications() {
            addDebug('üß™ Testando sistema de notifica√ß√µes...', 'info');
            
            showNotification('Teste de notifica√ß√£o 1');
            
            setTimeout(() => {
                showNotification('Teste de notifica√ß√£o 2');
            }, 500);
            
            setTimeout(() => {
                showNotification('Teste de notifica√ß√£o 3');
            }, 1000);
            
            addDebug('‚úÖ Teste de notifica√ß√µes conclu√≠do', 'success');
        }
        
        function testAchievements() {
            addDebug('üß™ Testando sistema de conquistas...', 'info');
            
            // Simular combo de 10x para desbloquear conquista
            comboStreak = 9;
            manageComboStreak('increment');
            
            addDebug('‚úÖ Teste de conquistas conclu√≠do', 'success');
        }
        
        function testErrorHandling() {
            addDebug('üß™ Testando tratamento de erros...', 'info');
            
            // Teste 1: A√ß√£o inv√°lida
            manageComboStreak('invalid_action');
            
            // Teste 2: Elemento inexistente
            try {
                const nonExistentElement = document.getElementById('non_existent');
                if (nonExistentElement) {
                    addDebug('‚ùå Elemento inexistente foi encontrado (erro)', 'error');
                } else {
                    addDebug('‚úÖ Elemento inexistente n√£o foi encontrado (correto)', 'success');
                }
            } catch (error) {
                addDebug(`‚ùå Erro ao verificar elemento: ${error.message}`, 'error');
            }
            
            addDebug('‚úÖ Teste de tratamento de erros conclu√≠do', 'success');
        }
        
        function checkFunctionDefinitions() {
            addDebug('üîç Verificando defini√ß√µes de fun√ß√µes...', 'info');
            
            const functions = [
                'manageComboStreak',
                'updateComboDisplay',
                'updateMultiplier',
                'updateComboProgressBar',
                'showNotification',
                'unlockAchievement'
            ];
            
            let allFunctionsExist = true;
            
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    addDebug(`‚úÖ Fun√ß√£o ${funcName} definida`, 'success');
                } else {
                    addDebug(`‚ùå Fun√ß√£o ${funcName} n√£o encontrada`, 'error');
                    allFunctionsExist = false;
                }
            });
            
            if (allFunctionsExist) {
                addDebug('üéâ Todas as fun√ß√µes est√£o definidas corretamente!', 'success');
            } else {
                addDebug('‚ö†Ô∏è Algumas fun√ß√µes est√£o faltando', 'error');
            }
        }
        
        function checkElementReferences() {
            addDebug('üéØ Verificando refer√™ncias de elementos...', 'info');
            
            const elements = [
                'cardsPlayed',
                'comboStreak',
                'currentMultiplier',
                'evidenceDisplay'
            ];
            
            let allElementsExist = true;
            
            elements.forEach(elementId => {
                const element = document.getElementById(elementId);
                if (element) {
                    addDebug(`‚úÖ Elemento ${elementId} encontrado`, 'success');
                } else {
                    addDebug(`‚ùå Elemento ${elementId} n√£o encontrado`, 'error');
                    allElementsExist = false;
                }
            });
            
            if (allElementsExist) {
                addDebug('üéâ Todos os elementos est√£o presentes!', 'success');
            } else {
                addDebug('‚ö†Ô∏è Alguns elementos est√£o faltando', 'error');
            }
        }
        
        function checkVariableScope() {
            addDebug('üì¶ Verificando escopo de vari√°veis...', 'info');
            
            const variables = [
                'cardsPlayed',
                'comboStreak',
                'currentEvidence',
                'maxEvidence',
                'maxCardsForLevel',
                'cardDatabase',
                'difficultySettings',
                'currentDifficulty',
                'achievements'
            ];
            
            let allVariablesExist = true;
            
            variables.forEach(varName => {
                if (typeof window[varName] !== 'undefined') {
                    addDebug(`‚úÖ Vari√°vel ${varName} definida`, 'success');
                } else {
                    addDebug(`‚ùå Vari√°vel ${varName} n√£o encontrada`, 'error');
                    allVariablesExist = false;
                }
            });
            
            if (allVariablesExist) {
                addDebug('üéâ Todas as vari√°veis est√£o definidas!', 'success');
            } else {
                addDebug('‚ö†Ô∏è Algumas vari√°veis est√£o faltando', 'error');
            }
        }
        
        function runFullDiagnostic() {
            addDebug('üî¨ Iniciando diagn√≥stico completo...', 'info');
            
            setTimeout(() => {
                checkFunctionDefinitions();
            }, 100);
            
            setTimeout(() => {
                checkElementReferences();
            }, 200);
            
            setTimeout(() => {
                checkVariableScope();
            }, 300);
            
            setTimeout(() => {
                testComboStreak();
            }, 400);
            
            setTimeout(() => {
                testNotifications();
            }, 500);
            
            setTimeout(() => {
                testAchievements();
            }, 600);
            
            setTimeout(() => {
                testErrorHandling();
            }, 700);
            
            setTimeout(() => {
                addDebug('üéâ Diagn√≥stico completo finalizado!', 'success');
            }, 800);
        }
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            addDebug('üöÄ Sistema de teste de corre√ß√£o inicializado', 'success');
            addDebug('üî• Combo Streak corrigido', 'success');
            addDebug('üîî Notifica√ß√µes corrigidas', 'success');
            addDebug('üèÜ Conquistas corrigidas', 'success');
            addDebug('üìä Contadores funcionando', 'success');
            
            // Inicializar displays
            updateComboDisplay();
            updateMultiplier();
            updateComboProgressBar();
        });
    </script>
</body>
</html>
