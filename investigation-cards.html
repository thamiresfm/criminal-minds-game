<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investigação - Criminal Minds Cards</title>
    
    <!-- Timer do Jogo -->
    <script src="js/simple-game-timer.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0f23, #1a1a2e, #16213e);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .game-container {
            display: grid;
            grid-template-columns: 320px 1fr 320px;
            grid-template-rows: 70px 1fr;
            height: 100vh;
            gap: 0.8rem;
            padding: 0.8rem;
            background: linear-gradient(135deg, #0f0f23, #1a1a2e, #16213e);
            box-shadow: inset 0 0 100px rgba(0, 0, 0, 0.3);
        }

        .header {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, rgba(15, 15, 35, 0.98), rgba(26, 26, 46, 0.98));
            border: 2px solid rgba(251, 191, 36, 0.4);
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(251, 191, 36, 0.1);
        }
        
        .header .case-title {
            flex: 1;
            text-align: left;
        }
        

        
        .header .btn {
            flex: 0 0 auto;
        }

        .case-title {
            font-size: 1.6rem;
            font-weight: 800;
            background: linear-gradient(45deg, #fbbf24, #f59e0b, #f97316);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 25px rgba(251, 191, 36, 0.4);
            letter-spacing: 0.5px;
        }



        .sidebar {
            background: linear-gradient(135deg, rgba(15, 15, 35, 0.98), rgba(26, 26, 46, 0.98));
            border: 2px solid rgba(251, 191, 36, 0.4);
            border-radius: 18px;
            padding: 1.2rem;
            backdrop-filter: blur(20px);
            overflow-y: auto;
            overflow-x: visible;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(251, 191, 36, 0.1);
            min-width: 0;
            max-width: 100%;
        }

        .main-area {
            background: linear-gradient(135deg, rgba(15, 15, 35, 0.98), rgba(26, 26, 46, 0.98));
            border: 2px solid rgba(251, 191, 36, 0.4);
            border-radius: 18px;
            padding: 2rem;
            backdrop-filter: blur(20px);
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(251, 191, 36, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: calc(100vh - 140px);
            position: relative;
        }

        /* EFEITO DE DESTAQUE PARA A SEÇÃO DE CARTAS */
        .main-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(251, 191, 36, 0.05) 0%, transparent 70%);
            pointer-events: none;
            z-index: 1;
        }

        .main-area > * {
            position: relative;
            z-index: 2;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 2rem;
            color: #fbbf24;
            border-bottom: 3px solid rgba(251, 191, 36, 0.5);
            padding-bottom: 1rem;
            text-shadow: 0 0 15px rgba(251, 191, 36, 0.5);
            flex-shrink: 0;
            text-align: center;
            letter-spacing: 1px;
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.1));
            padding: 1rem 2rem;
            border-radius: 12px;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        /* OCULTAR SEÇÃO MINHA MÃO - VERSÃO EXPANDIDA */
        .deck-area,
        .hand-cards,
        .mini-card,
        [class*="hand"],
        [id*="hand"],
        [class*="mao"],
        [id*="mao"],
        [class*="deck"],
        [id*="deck"],
        [data-type*="hand"],
        [data-type*="deck"],
        .sidebar .deck-area,
        .sidebar [class*="hand"],
        .sidebar [class*="mini"],
        .sidebar [class*="card"]:not(.main-area .card) {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            height: 0 !important;
            overflow: hidden !important;
        }
        
        /* SISTEMA DE CARTAS - GRID MELHORADO */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(3, 280px);
            grid-template-rows: repeat(2, 280px);
            gap: 2rem;
            justify-content: center;
            align-content: center;
            width: fit-content;
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
            background: rgba(15, 15, 35, 0.4);
            border-radius: 25px;
            border: 3px solid rgba(251, 191, 36, 0.4);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4), inset 0 2px 0 rgba(251, 191, 36, 0.1);
            backdrop-filter: blur(10px);
        }
        
        /* Grid específico para iniciante (6 cartas = 2x3) */
        .cards-container.beginner {
            grid-template-rows: repeat(2, 280px) !important;
            gap: 2rem !important;
            max-width: 1000px !important;
            padding: 2rem !important;
            align-content: center;
        }
        
        /* Grid específico para intermediário (9 cartas = 3x3) */
        .cards-container.intermediate {
            grid-template-rows: repeat(3, 280px) !important;
            gap: 2rem !important;
            max-width: 1000px !important;
            padding: 2rem !important;
            align-content: center;
        }
        
        /* Grid específico para difícil (12 cartas = 4x3) */
        .cards-container.hard {
            grid-template-rows: repeat(4, 280px) !important;
            gap: 2rem !important;
            max-width: 1000px !important;
            padding: 2rem !important;
            align-content: center;
        }
        
        /* Media queries para responsividade */
        @media (max-width: 1200px) {
            .cards-container {
                max-width: 1200px;
                grid-template-columns: repeat(3, 520px);
                grid-template-rows: repeat(2, 420px);
                gap: 2.5rem;
                padding: 3rem;
            }
            
            .card {
                width: 520px !important;
                height: 420px !important;
            }
            
            .card-icon {
                font-size: 2rem !important;
                top: 25% !important;
                left: 12% !important;
            }
            
            .card-title {
                font-size: 1rem;
            }
            
            .card-description {
                font-size: 1.1rem;
            }
        }
        
        @media (max-width: 768px) {
            .cards-container {
                max-width: 720px;
                grid-template-columns: repeat(2, 350px);
                grid-template-rows: repeat(3, 280px);
                gap: 2rem;
                padding: 2.5rem;
            }
            
            .card {
                width: 350px !important;
                height: 280px !important;
            }
            
            .card-icon {
                font-size: 2rem !important;
                top: 25% !important;
                left: 12% !important;
            }
            
            .card-title {
                font-size: 1rem;
            }
            
            .card-description {
                font-size: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .cards-container {
                grid-template-columns: repeat(2, 250px);
                grid-template-rows: repeat(3, 200px);
                max-width: 520px;
                gap: 1.5rem;
                padding: 2rem;
            }
            
            .card {
                width: 250px !important;
                height: 200px !important;
            }
            
            .card-icon {
                font-size: 2rem !important;
                top: 25% !important;
                left: 12% !important;
            }
            
            .card-title {
                font-size: 1rem;
            }
            
            .card-description {
                font-size: 0.9rem;
            }
        }

        .card {
            position: relative;
            width: 280px !important;
            height: 280px !important;
            margin: 0;
            border-radius: 18px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
            perspective: 1000px;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.98));
            border: 2px solid rgba(251, 191, 36, 0.4);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(251, 191, 36, 0.1);
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: flex-start;
            overflow: hidden;
            padding: 1.8rem;
        }

        .card:hover {
            transform: translateY(-15px) rotateX(8deg) rotateY(8deg) scale(1.05);
            box-shadow: 0 25px 50px rgba(251, 191, 36, 0.3), 0 0 30px rgba(251, 191, 36, 0.2);
            cursor: pointer;
            border-color: rgba(251, 191, 36, 0.8);
        }

        .card:active {
            transform: translateY(-5px) rotateX(2deg) rotateY(2deg);
            box-shadow: 0 15px 30px rgba(251, 191, 36, 0.3);
        }

        .card.played {
            opacity: 0.6;
            transform: scale(0.95);
            filter: grayscale(50%);
            border-color: rgba(107, 114, 128, 0.4);
            background: linear-gradient(135deg, rgba(75, 85, 99, 0.95), rgba(55, 65, 81, 0.98));
            cursor: not-allowed;
        }

        .card.played:hover {
            transform: scale(0.95);
            border-color: rgba(107, 114, 128, 0.4);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
        }

        .card.played::after {
            content: '✓';
            position: absolute;
            top: 5px;
            right: 5px;
            background: #10b981;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            z-index: 10;
        }

        .card:not(.played) {
            cursor: pointer;
            user-select: none;
        }

        .card:not(.played):hover {
            transform: translateY(-15px) rotateX(8deg) rotateY(8deg) scale(1.05);
            box-shadow: 0 25px 50px rgba(251, 191, 36, 0.3), 0 0 30px rgba(251, 191, 36, 0.2);
            border-color: rgba(251, 191, 36, 0.8);
        }

        .card:not(.played):active {
            transform: translateY(-5px) rotateX(2deg) rotateY(2deg);
            box-shadow: 0 15px 30px rgba(251, 191, 36, 0.3);
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            border-radius: 15px;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(22, 33, 62, 0.9), rgba(15, 15, 35, 0.9));
            border: 2px solid transparent;
            background-clip: padding-box;
        }

        /* RARIDADES DAS CARTAS */
        .card.common .card-inner {
            border-image: linear-gradient(45deg, #6b7280, #9ca3af) 1;
            box-shadow: 0 0 20px rgba(107, 114, 128, 0.3);
        }

        .card.rare .card-inner {
            border-image: linear-gradient(45deg, #3b82f6, #60a5fa) 1;
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.4);
        }

        .card.epic .card-inner {
            border-image: linear-gradient(45deg, #8b5cf6, #a78bfa) 1;
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.5);
        }

        .card.legendary .card-inner {
            border-image: linear-gradient(45deg, #f59e0b, #fbbf24, #f97316) 1;
            box-shadow: 0 0 35px rgba(251, 191, 36, 0.6);
            animation: legendaryGlow 3s ease-in-out infinite alternate;
        }

        @keyframes legendaryGlow {
            0% { box-shadow: 0 0 35px rgba(251, 191, 36, 0.6); }
            100% { box-shadow: 0 0 50px rgba(251, 191, 36, 0.8); }
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.2rem 0.5rem;
        }

        .card-type {
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            opacity: 0.8;
        }

        .card-rarity {
            position: absolute;
            top: 0.8rem;
            right: 0.8rem;
            font-size: 0.8rem;
            font-weight: 700;
            padding: 0.3rem 0.6rem;
            border-radius: 10px;
            text-transform: uppercase;
            z-index: 3;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
        }

        .rarity-common { background: #6b7280; color: white; }
        .rarity-rare { background: #3b82f6; color: white; }
        .rarity-epic { background: #8b5cf6; color: white; }
        .rarity-legendary { 
            background: linear-gradient(45deg, #f59e0b, #fbbf24);
            color: #0f0f23;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .card-icon {
            font-size: 3rem !important;
            text-align: center !important;
            margin-right: 1.5rem !important;
            filter: drop-shadow(0 0 8px rgba(251, 191, 36, 0.7)) !important;
            flex-shrink: 0 !important;
            color: white !important;
            position: static !important;
            z-index: 1 !important;
        }

        .card-title {
            font-size: 1.2rem !important;
            font-weight: bold !important;
            color: white !important;
            text-align: center !important;
            margin: 0 auto !important;
            text-transform: uppercase !important;
            line-height: 1.4 !important;
            flex: 1 !important;
            position: static !important;
            z-index: 3 !important;
            word-wrap: break-word !important;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.6) !important;
            white-space: normal !important;
            overflow: hidden !important;
            max-width: 180px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }

        .card-description {
            display: none;
        }
        
        /* Valor numérico no canto inferior esquerdo */
        .card-value {
            display: none !important;
        }
        
        .card-value-icon {
            width: 20px !important;
            height: 20px !important;
            background: #fbbf24 !important;
            border-radius: 50% !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            font-size: 10px !important;
            color: #000 !important;
            font-weight: bold !important;
        }
        
        .card-value-number {
            font-size: 1rem !important;
            font-weight: bold !important;
            color: white !important;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5) !important;
        }

        .card-stats {
            display: none;
        }
        
        /* Barra de progresso no centro inferior */
        .card-progress {
            display: none !important;
        }
        
        .card-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ef4444, #dc2626);
            border-radius: 3px;
            transition: width 0.3s ease;
            width: 75%; /* Valor padrão, será ajustado via JavaScript */
        }

        /* Rótulo de raridade */
        .card-rarity {
            position: absolute;
            top: 0.8rem;
            right: 0.8rem;
            background: rgba(59, 130, 246, 0.9);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
            z-index: 3;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .card-rarity.epic {
            background: rgba(139, 92, 246, 0.8);
        }

        .card-rarity.legendary {
            background: rgba(245, 158, 11, 0.8);
        }

        .card-rarity.common {
            background: rgba(107, 114, 128, 0.8);
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 0.2rem;
        }
        
        /* Descrição/estatística no canto inferior direito */
        .card-stat {
            display: none !important;
        }

        /* EFEITO DE FLIP DAS CARTAS */
        .card-flip {
            perspective: 1000px;
        }

        .card-flip .card-inner {
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }

        .card-flip.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
        }

        .card-back {
            transform: rotateY(180deg);
            background: linear-gradient(135deg, rgba(15, 15, 35, 0.95), rgba(22, 33, 62, 0.95));
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* DECK E MÃO DE CARTAS */
        .deck-area {
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(22, 33, 62, 0.6);
            border: 2px solid rgba(251, 191, 36, 0.2);
            border-radius: 15px;
        }

        .hand-cards {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding: 1rem 0;
        }

        .mini-card {
            min-width: 120px;
            height: 80px;
            border-radius: 8px;
            background: linear-gradient(135deg, rgba(22, 33, 62, 0.9), rgba(15, 15, 35, 0.9));
            border: 1px solid rgba(251, 191, 36, 0.3);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mini-card:hover {
            transform: translateY(-5px);
            border-color: #fbbf24;
            box-shadow: 0 10px 20px rgba(251, 191, 36, 0.2);
        }

        .mini-card-icon {
            font-size: 1.5rem;
            margin-bottom: 0.3rem;
        }

        .mini-card-title {
            font-size: 0.7rem;
            font-weight: 600;
            color: #fbbf24;
            text-align: center;
        }

        /* BOTÕES MODERNOS */
        .btn {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #0f0f23;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3);
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.5);
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover {
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.5);
            background: linear-gradient(135deg, #dc2626, #ef4444);
        }

        .btn-exit {
            background: linear-gradient(135deg, #4b5563, #374151);
            color: white;
            border: 2px solid #9ca3af;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .btn-exit:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            border-color: #d1d5db;
            background: linear-gradient(135deg, #6b7280, #4b5563);
        }



        .timer-highlighted {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ef4444;
            text-shadow: 0 0 10px rgba(239, 68, 68, 0.6);
            background: rgba(239, 68, 68, 0.2);
            padding: 0.3rem 0.8rem;
            border-radius: 6px;
            border: 1px solid rgba(239, 68, 68, 0.4);
        }





        /* MODAL MODERNO */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 3px solid #fbbf24;
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #fbbf24;
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }

        /* PROGRESS BARS MODERNAS */
        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(15, 15, 35, 0.8);
            border-radius: 6px;
            margin-top: 1rem;
            overflow: hidden;
            border: 1px solid rgba(251, 191, 36, 0.2);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #fbbf24, #f59e0b, #f97316);
            transition: width 0.5s ease;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
        }

        /* CHAT MODERNO */
        .chat-container {
            height: 200px;
            background: rgba(15, 15, 35, 0.6);
            border: 2px solid rgba(251, 191, 36, 0.3);
            border-radius: 15px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            overflow-y: auto;
            overflow-x: hidden;
            backdrop-filter: blur(10px);
            width: 100%;
            box-sizing: border-box;
        }

        .chat-message {
            margin-bottom: 0.8rem;
            padding: 0.8rem;
            background: linear-gradient(135deg, rgba(15, 15, 35, 0.8), rgba(26, 26, 46, 0.8));
            border-radius: 10px;
            border-left: 3px solid #fbbf24;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .chat-message:hover {
            transform: translateX(2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .chat-message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.4rem;
        }

        .chat-user {
            font-weight: bold;
            color: #fbbf24;
            font-size: 0.9rem;
        }

        .chat-time {
            font-size: 0.7rem;
            color: #6b7280;
            opacity: 0.8;
        }

        .chat-content {
            color: #e2e8f0;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .chat-input-container {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1rem;
            width: 100%;
            box-sizing: border-box;
            max-width: 100%;
        }

        .chat-input-field {
            width: 100%;
            padding: 1rem 1.2rem;
            border: 2px solid rgba(251, 191, 36, 0.3);
            border-radius: 15px;
            background: rgba(15, 15, 35, 0.9);
            color: white;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-sizing: border-box;
        }

        .chat-input-field:focus {
            outline: none;
            border-color: #fbbf24;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.4);
            background: rgba(15, 15, 35, 0.95);
            transform: translateY(-2px);
        }

        .chat-input-field::placeholder {
            color: rgba(203, 213, 225, 0.6);
            font-style: italic;
        }

        /* BOTÃO ENVIAR FULL-WIDTH - EMBAIXO DO INPUT */
        .send-button {
            background: linear-gradient(135deg, #fbbf24, #f59e0b, #f97316);
            color: #0f0f23;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            font-weight: 800;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            width: 100%;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
            background-clip: padding-box;
            box-sizing: border-box;
        }

        .send-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s ease;
        }

        .send-button:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 10px 30px rgba(251, 191, 36, 0.6);
            background: linear-gradient(135deg, #f59e0b, #fbbf24, #f97316);
            border-color: rgba(251, 191, 36, 0.8);
        }

        .send-button:hover::before {
            left: 100%;
        }

        .send-button:active {
            transform: translateY(-2px) scale(0.95);
            box-shadow: 0 6px 20px rgba(251, 191, 36, 0.5);
            transition: all 0.1s ease;
        }

        .send-button:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.3);
        }

        .send-button-icon {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .send-button:hover .send-button-icon {
            transform: translateX(3px) scale(1.1);
        }

        .send-button-text {
            font-size: 0.9rem;
            font-weight: 800;
            transition: all 0.3s ease;
        }

        .send-button-ripple {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            transform: translate(-50%, -50%);
            transition: width 0.6s ease, height 0.6s ease;
            pointer-events: none;
        }

        .send-button:active .send-button-ripple {
            width: 100px;
            height: 100px;
        }

        /* ANIMAÇÃO DE PULSE PARA CHAMAR ATENÇÃO */
        @keyframes sendPulse {
            0% { box-shadow: 0 4px 15px rgba(251, 191, 36, 0.4); }
            50% { box-shadow: 0 4px 25px rgba(251, 191, 36, 0.7); }
            100% { box-shadow: 0 4px 15px rgba(251, 191, 36, 0.4); }
        }

        .send-button.highlight {
            animation: sendPulse 1.5s ease-in-out infinite;
        }

        /* RESPONSIVIDADE DO CHAT MELHORADA - LAYOUT VERTICAL */
        @media (max-width: 1024px) {
            .chat-input-container {
                gap: 0.6rem;
            }
            
            .chat-input-field {
                padding: 0.9rem 1rem;
                font-size: 0.9rem;
            }
            
            .send-button {
                padding: 0.9rem 1.2rem;
                font-size: 0.85rem;
                gap: 0.4rem;
            }
        }

        @media (max-width: 768px) {
            .chat-input-container {
                gap: 0.5rem;
            }
            
            .chat-input-field {
                padding: 0.8rem 1rem;
                font-size: 0.85rem;
                border-radius: 10px;
            }
            
            .send-button {
                padding: 0.8rem 1rem;
                font-size: 0.8rem;
                gap: 0.3rem;
                border-radius: 10px;
            }
            
            .send-button-text {
                font-size: 0.8rem;
            }
            
            .send-button-icon {
                font-size: 1.1rem;
            }
        }

        @media (max-width: 480px) {
            .chat-input-container {
                gap: 0.4rem;
            }
            
            .chat-input-field {
                padding: 0.7rem 0.9rem;
                font-size: 0.8rem;
                border-radius: 8px;
            }
            
            .send-button {
                padding: 0.7rem 0.8rem;
                font-size: 0.75rem;
                gap: 0.2rem;
                border-radius: 8px;
            }
            
            .send-button-text {
                font-size: 0.75rem;
            }
            
            .send-button-icon {
                font-size: 1rem;
            }
        }

        @media (max-width: 360px) {
            .chat-input-container {
                gap: 0.3rem;
            }
            
            .chat-input-field {
                padding: 0.6rem 0.8rem;
                font-size: 0.75rem;
            }
            
            .send-button {
                padding: 0.6rem 0.7rem;
                font-size: 0.7rem;
                gap: 0.15rem;
            }
            
            .send-button-text {
                font-size: 0.7rem;
            }
            
            .send-button-icon {
                font-size: 0.9rem;
            }
        }

        /* CORREÇÕES CRÍTICAS DE LAYOUT */
            .game-container {
            display: grid !important;
            grid-template-columns: 300px 1fr 300px !important;
            grid-template-rows: 80px 1fr !important;
            height: 100vh !important;
            gap: 1rem !important;
            padding: 1rem !important;
            max-width: 100vw !important;
            overflow: hidden !important;
            }




        
        .sidebar {
            padding: 1rem !important;
            overflow-y: auto !important;
            overflow-x: hidden !important;
            max-height: calc(100vh - 120px) !important;
            display: flex !important;
            flex-direction: column !important;
        }
        
        /* Correção específica para sidebar direita com cartas */
        .sidebar:last-child {
            padding-bottom: 2rem !important;
        }
        
        .deck-area {
            margin-bottom: 2rem !important;
        }
        
        .main-area {
            padding: 1.5rem !important;
            overflow-y: auto !important;
            overflow-x: hidden !important;
            max-height: calc(100vh - 120px) !important;
        }

        /* MODAL DE DETALHES DAS CARTAS */
        .card-details-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.98));
            border: 3px solid rgba(251, 191, 36, 0.6);
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            transition: transform 0.3s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            z-index: 10001;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(251, 191, 36, 0.3);
        }

        .modal-header h2 {
            color: #fbbf24;
            margin: 0;
            font-size: 1.5rem;
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }

        .close-btn {
            background: none;
            border: none;
            color: #fbbf24;
            font-size: 2rem;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(251, 191, 36, 0.2);
            transform: scale(1.1);
        }

        .card-detail-main {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(251, 191, 36, 0.1);
            border-radius: 15px;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .detail-icon {
            font-size: 3rem;
            filter: drop-shadow(0 0 10px rgba(251, 191, 36, 0.5));
        }

        .detail-info h3 {
            color: white;
            margin: 0 0 0.5rem 0;
            font-size: 1.3rem;
        }

        .detail-type, .detail-rarity {
            color: #fbbf24;
            margin: 0.2rem 0;
            font-size: 0.9rem;
        }

        .card-detail-description, .card-detail-clues, .card-detail-stats {
            margin-bottom: 1.5rem;
        }

        .card-detail-description h4, .card-detail-clues h4, .card-detail-stats h4 {
            color: #fbbf24;
            margin-bottom: 0.8rem;
            font-size: 1.1rem;
        }

        .card-detail-description p {
            color: #e5e7eb;
            line-height: 1.6;
            margin: 0;
        }

        .card-detail-clues ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .card-detail-clues li {
            color: #e5e7eb;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(251, 191, 36, 0.2);
            position: relative;
            padding-left: 1.5rem;
        }

        .card-detail-clues li:before {
            content: '🔍';
            position: absolute;
            left: 0;
            top: 0.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.8rem;
        }

        .stat-item {
            background: rgba(251, 191, 36, 0.1);
            padding: 0.8rem;
            border-radius: 10px;
            text-align: center;
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .card-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        .btn-play, .btn-close {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-play {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-play:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }

        .btn-close {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .btn-close:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.4);
        }

        .btn-view-cards {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            border: 2px solid #8b5cf6;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .btn-view-cards:hover {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
            border: 2px solid #6b7280;
            box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #4b5563, #374151);
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(107, 114, 128, 0.4);
        }

        .card-status.played {
            color: #10b981;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .all-cards-modal {
            max-width: 800px !important;
            max-height: 90vh !important;
        }

        .all-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            max-height: 60vh;
            overflow-y: auto;
        }

        .all-cards-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .all-cards-item.played {
            opacity: 0.6;
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.3);
        }

        .all-cards-icon {
            font-size: 2rem;
            filter: drop-shadow(0 0 5px rgba(251, 191, 36, 0.5));
        }

        .all-cards-info h4 {
            color: white;
            margin: 0 0 0.3rem 0;
            font-size: 1rem;
        }

        .all-cards-info p {
            color: #fbbf24;
            margin: 0 0 0.5rem 0;
            font-size: 0.8rem;
        }

        .played-badge {
            background: #10b981;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .available-badge {
            background: #fbbf24;
            color: #1f2937;
            padding: 0.2rem 0.5rem;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        /* Estilos para interação com detalhes das cartas */
        .all-cards-item:hover {
            background: rgba(251, 191, 36, 0.2);
            border-color: rgba(251, 191, 36, 0.6);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
        }
        
        .all-cards-action {
            margin-left: auto;
        }
        
        .view-details-btn {
            color: #fbbf24;
            font-size: 0.8rem;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }
        
        .all-cards-item:hover .view-details-btn {
            opacity: 1;
        }
        
        /* Estilos para o modal de detalhes */
        .card-details-content {
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .card-details-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #374151;
        }
        
        .card-details-icon {
            font-size: 3rem;
            margin-right: 1rem;
        }
        
        .card-details-info h3 {
            margin: 0 0 0.5rem 0;
            color: #f9fafb;
        }
        
        .card-type {
            color: #9ca3af;
            margin: 0 0 0.5rem 0;
        }
        
        .card-status {
            color: #10b981;
            font-weight: bold;
            margin: 0;
        }
        
        .card-details-section {
            margin-bottom: 1.5rem;
        }
        
        .card-details-section h4 {
            color: #fbbf24;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }
        
        .investigation-clues {
            list-style: none;
            padding: 0;
        }
        
        .investigation-clues li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #374151;
            color: #d1d5db;
        }
        
        .investigation-clues li:last-child {
            border-bottom: none;
        }
        
        .card-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem;
            background: #374151;
            border-radius: 6px;
        }
        
        .stat-label {
            color: #9ca3af;
        }
        
        .stat-value {
            color: #fbbf24;
            font-weight: bold;
        }
        
        .card-details-actions {
            text-align: center;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #374151;
        }
        
        /* Melhorias no layout das cartas */
        .card-action {
            position: absolute;
            bottom: 0.5rem;
            left: 0;
            right: 0;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .card:hover .card-action {
            opacity: 1;
        }
        
        .view-details-hint {
            color: #fbbf24;
            font-size: 0.8rem;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(251, 191, 36, 0.5);
        }
        
        /* Melhorias no modal de detalhes */
        .card-details-content {
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
            background: linear-gradient(135deg, #1f2937, #111827);
            border: 2px solid #fbbf24;
            border-radius: 15px;
        }
        
        .card-effects {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
            margin-top: 0.5rem;
        }
        
        .effect-item {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.3);
            border-radius: 8px;
            padding: 0.75rem;
            font-size: 0.9rem;
            color: #d1d5db;
        }
        
        .effect-item:hover {
            background: rgba(251, 191, 36, 0.2);
            border-color: rgba(251, 191, 36, 0.5);
        }
        
        /* Melhorias na responsividade das cartas */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .card {
            position: relative;
            width: 100%;
            height: 320px;
            margin: 0;
            border-radius: 18px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
            perspective: 1000px;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.98));
            border: 2px solid rgba(251, 191, 36, 0.4);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(251, 191, 36, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            overflow: hidden;
            padding: 1.5rem;
        }
        
        .card-inner {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            text-align: center;
        }
        
        .card-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .card-type {
            color: #9ca3af;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .card-rarity {
            color: #fbbf24;
            font-size: 0.7rem;
            font-weight: bold;
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            background: rgba(251, 191, 36, 0.1);
        }
        
        .card-icon {
            font-size: 3rem;
            margin: 1rem 0;
            filter: drop-shadow(0 0 10px rgba(251, 191, 36, 0.5));
        }
        
        .card-title {
            color: #f9fafb;
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            line-height: 1.3;
        }
        
        .card-description {
            color: #d1d5db;
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 1rem;
            flex-grow: 1;
        }
        
        .card-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .stat {
            color: #fbbf24;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* RESPONSIVIDADE BÁSICA */
        @media (max-width: 1400px) {
            .game-container {
                grid-template-columns: 280px 1fr 280px !important;
            }
        }
        
        @media (max-width: 1200px) {
            .game-container {
                grid-template-columns: 1fr !important;
                grid-template-rows: auto auto 1fr auto !important;
                height: auto !important;
                min-height: 100vh !important;
                padding: 0.8rem !important;
            }

            .sidebar {
                padding: 1rem 0.8rem !important;
                overflow-x: visible !important;
                max-height: none !important;
            }
            
            .main-area {
                max-height: none !important;
            }
            
            .chat-input-container {
                max-width: 100% !important;
            }
        }
        
        /* CORREÇÕES ESPECÍFICAS PARA MINHA MÃO - LAYOUT 3 COLUNAS */
        .hand-cards {
            display: grid !important;
            grid-template-columns: repeat(3, 1fr) !important;
            gap: 1rem !important;
            margin-top: 1rem !important;
            margin-bottom: 1.5rem !important;
            padding: 1.5rem !important;
            background: rgba(15, 15, 35, 0.7) !important;
            border-radius: 20px !important;
            border: 2px solid rgba(251, 191, 36, 0.5) !important;
            box-shadow: 0 6px 30px rgba(0, 0, 0, 0.4) !important;
            max-width: 100% !important;
            }

            .mini-card {
            height: 150px !important;
            min-height: 150px !important;
            display: flex !important;
            flex-direction: column !important;
            justify-content: space-between !important;
            align-items: center !important;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #1e1e3f) !important;
            border: 2px solid rgba(251, 191, 36, 0.4) !important;
            border-radius: 15px !important;
            padding: 1rem !important;
            cursor: pointer !important;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
            text-align: center !important;
            position: relative !important;
            overflow: visible !important;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3) !important;
        }
        
        .mini-card:hover {
            transform: translateY(-4px) scale(1.05) !important;
            border-color: rgba(251, 191, 36, 0.8) !important;
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.3) !important;
            background: linear-gradient(135deg, #1e1e3f, #1a2040) !important;
        }
        
        .mini-card:active {
            transform: translateY(-2px) scale(1.02) !important;
        }
        
        .mini-card-icon {
            font-size: 2rem !important;
            margin-bottom: 0.75rem !important;
            filter: drop-shadow(0 0 10px rgba(251, 191, 36, 0.5)) !important;
            flex-shrink: 0 !important;
        }
        
        .mini-card-title {
            font-size: 0.9rem !important;
            color: #fbbf24 !important;
            font-weight: 700 !important;
            line-height: 1.2 !important;
            text-shadow: 0 0 8px rgba(251, 191, 36, 0.4) !important;
            white-space: normal !important;
            overflow: visible !important;
            text-overflow: unset !important;
            width: 100% !important;
            text-align: center !important;
            margin-top: auto !important;
        }
        
        /* Botões da área de mão */
        .hand-buttons {
            display: flex !important;
            gap: 0.5rem !important;
            margin-top: 1rem !important;
            justify-content: center !important;
            flex-wrap: wrap !important;
        }
        
        .hand-buttons button {
            padding: 0.5rem 1rem !important;
            font-size: 0.85rem !important;
            min-width: auto !important;
            flex: none !important;
        }
        
        /* Responsividade para mão - Layout 3 colunas otimizado */
        @media (max-width: 768px) {
            .hand-cards {
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 0.75rem !important;
                padding: 1.25rem !important;
            }
            
            .mini-card {
                height: 140px !important;
                min-height: 140px !important;
                padding: 0.75rem !important;
            }
            
            .mini-card-icon {
                font-size: 1.75rem !important;
                margin-bottom: 0.5rem !important;
            }
            
            .mini-card-title {
                font-size: 0.8rem !important;
                line-height: 1.1 !important;
            }
        }
        
        @media (max-width: 480px) {
            .hand-cards {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 0.75rem !important;
                padding: 1rem !important;
            }
            
            .mini-card {
                height: 130px !important;
                min-height: 130px !important;
                padding: 0.75rem !important;
            }
            
            .mini-card-icon {
                font-size: 1.5rem !important;
                margin-bottom: 0.5rem !important;
            }
            
            .mini-card-title {
                font-size: 0.75rem !important;
                line-height: 1.1 !important;
            }
        }
        
        @media (max-width: 360px) {
            .hand-cards {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 0.5rem !important;
                padding: 0.75rem !important;
            }
            
            .mini-card {
                height: 120px !important;
                min-height: 120px !important;
                padding: 0.5rem !important;
            }
            
            .mini-card-icon {
                font-size: 1.25rem !important;
                margin-bottom: 0.25rem !important;
            }
            
            .mini-card-title {
                font-size: 0.7rem !important;
                line-height: 1 !important;
            }
        }

        /* ANIMAÇÕES EXTRAS */
        @keyframes cardAppear {
            0% {
                opacity: 0;
                transform: translateY(50px) rotateX(-30deg);
            }
            100% {
                opacity: 1;
                transform: translateY(0) rotateX(0);
            }
        }

        @keyframes slideIn {
            0% {
                opacity: 0;
                transform: translateX(50px) scale(0.8);
            }
            100% {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        /* EFEITOS PARA BOTÃO DISABLED */
        .send-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none !important;
        }

        .send-button:disabled:hover {
            transform: none !important;
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3) !important;
        }

        .card {
            animation: cardAppear 0.6s ease-out;
        }

        .card:nth-child(1) { animation-delay: 0.1s; }
        .card:nth-child(2) { animation-delay: 0.2s; }
        .card:nth-child(3) { animation-delay: 0.3s; }
        .card:nth-child(4) { animation-delay: 0.4s; }
        .card:nth-child(5) { animation-delay: 0.5s; }
        .card:nth-child(6) { animation-delay: 0.6s; }

        /* FORÇAR LAYOUT 3 COLUNAS - MÁXIMA ESPECIFICIDADE */
        html body .sidebar .deck-area .hand-cards {
            display: grid !important;
            grid-template-columns: repeat(3, 1fr) !important;
            gap: 1rem !important;
            margin-top: 1rem !important;
            margin-bottom: 1.5rem !important;
            padding: 1.5rem !important;
            background: rgba(15, 15, 35, 0.7) !important;
            border-radius: 20px !important;
            border: 2px solid rgba(251, 191, 36, 0.5) !important;
            box-shadow: 0 6px 30px rgba(0, 0, 0, 0.4) !important;
            max-width: 100% !important;
        }

        html body .sidebar .deck-area .hand-cards .mini-card {
            height: 150px !important;
            min-height: 150px !important;
            display: flex !important;
            flex-direction: column !important;
            justify-content: space-between !important;
            align-items: center !important;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #1e1e3f) !important;
            border: 2px solid rgba(251, 191, 36, 0.4) !important;
            border-radius: 15px !important;
            padding: 1rem !important;
            cursor: pointer !important;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
            text-align: center !important;
            position: relative !important;
            overflow: visible !important;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3) !important;
        }

        html body .sidebar .deck-area .hand-cards .mini-card:hover {
            transform: translateY(-4px) scale(1.05) !important;
            border-color: rgba(251, 191, 36, 0.8) !important;
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.3) !important;
            background: linear-gradient(135deg, #1e1e3f, #1a2040) !important;
        }

        html body .sidebar .deck-area .hand-cards .mini-card-icon {
            font-size: 2rem !important;
            margin-bottom: 0.75rem !important;
            filter: drop-shadow(0 0 10px rgba(251, 191, 36, 0.5)) !important;
            flex-shrink: 0 !important;
        }

        html body .sidebar .deck-area .hand-cards .mini-card-title {
            font-size: 0.9rem !important;
            color: #fbbf24 !important;
            font-weight: 700 !important;
            line-height: 1.2 !important;
            text-shadow: 0 0 8px rgba(251, 191, 36, 0.4) !important;
            white-space: normal !important;
            overflow: visible !important;
            text-overflow: unset !important;
            width: 100% !important;
            text-align: center !important;
            margin-top: auto !important;
        }

        /* ESTILOS PARA CONQUISTAS RECENTES */
        .achievements-container {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .achievement-item {
            margin-bottom: 0.8rem;
            padding: 0.8rem;
            border-radius: 12px;
            border-left: 4px solid;
            background: rgba(15, 15, 35, 0.8);
            backdrop-filter: blur(10px);
            animation: achievementSlideIn 0.5s ease-out;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .achievement-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .achievement-item.gold {
            border-left-color: #fbbf24;
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(15, 15, 35, 0.9));
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.2);
        }

        .achievement-item.silver {
            border-left-color: #94a3b8;
            background: linear-gradient(135deg, rgba(148, 163, 184, 0.1), rgba(15, 15, 35, 0.9));
            box-shadow: 0 0 15px rgba(148, 163, 184, 0.2);
        }

        .achievement-item.bronze {
            border-left-color: #f97316;
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.1), rgba(15, 15, 35, 0.9));
            box-shadow: 0 0 15px rgba(249, 115, 22, 0.2);
        }

        .achievement-item.rare {
            border-left-color: #8b5cf6;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(15, 15, 35, 0.9));
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.2);
        }

        .achievement-icon {
            font-size: 1.2rem;
            margin-right: 0.5rem;
            filter: drop-shadow(0 0 5px rgba(251, 191, 36, 0.5));
        }

        .achievement-title {
            font-weight: 700;
            font-size: 0.9rem;
            color: #fbbf24;
            margin-bottom: 0.2rem;
            text-shadow: 0 0 5px rgba(251, 191, 36, 0.3);
        }

        .achievement-description {
            font-size: 0.75rem;
            color: #94a3b8;
            line-height: 1.2;
        }

        .achievement-reward {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            font-size: 0.7rem;
            color: #10b981;
            font-weight: 600;
            background: rgba(16, 185, 129, 0.1);
            padding: 0.2rem 0.4rem;
            border-radius: 6px;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .achievement-timestamp {
            font-size: 0.65rem;
            color: #64748b;
            margin-top: 0.3rem;
            font-style: italic;
        }

        @keyframes achievementSlideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .achievements-container::-webkit-scrollbar {
            width: 4px;
        }

        .achievements-container::-webkit-scrollbar-track {
            background: rgba(15, 15, 35, 0.5);
            border-radius: 2px;
        }

        .achievements-container::-webkit-scrollbar-thumb {
            background: rgba(251, 191, 36, 0.3);
            border-radius: 2px;
        }

        .achievements-container::-webkit-scrollbar-thumb:hover {
            background: rgba(251, 191, 36, 0.5);
        }




    </style>
    <!-- Criminal Minds API v2.0 - Sistema Melhorado -->
    <script src="js/api-client-simple.js?v=20241209_1"></script>
    <script src="js/game-functions.js?v=20241209_1"></script>
    <script defer src="js/comprehensive-test-system.js?v=20241209_1"></script>
    <script defer src="js/enhanced-game-system.js?v=20241209_1"></script>
    <script defer src="js/complete-hand-system.js?v=20241209_1"></script>
    <!-- AggressiveFix desativado nesta tela -->
    <script defer src="js/layout-fix-system.js?v=20241209_1"></script>
    <script defer src="js/layout-diagnostic-system.js?v=20241209_1"></script>
    <script defer src="js/layout-repair-system.js?v=20241209_1"></script>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <div style="display: flex; align-items: center; gap: 1rem; margin-right: 2rem;">
                <button class="btn btn-exit" onclick="exitGame()">← SAIR</button>
            </div>
            <div style="display: flex; align-items: center; justify-content: center; flex: 1; margin: 0 3rem;">
                <div class="case-title" style="color: #fbbf24; font-size: 1.6rem;">🟡 CRIMINAL MINDS: INICIANTE</div>
            </div>
            <div style="display: flex; align-items: center; gap: 1rem; margin-left: 2rem;">
                <button class="btn btn-view-cards" onclick="showAllCards()">👁️ Ver Todas as Cartas</button>

                <button class="btn btn-danger" onclick="makeAccusation()">ACUSAR</button>
            </div>
        </div>

        <div class="sidebar">
            <div class="section-title">🕵️ Equipe Online</div>
            <div class="team-list" id="teamList">
                <div class="chat-message">
                    <span class="chat-user">👑 Detetive Reid:</span> Online - 127 cartas
                </div>
                <div class="chat-message">
                    <span class="chat-user">🔍 Agente Morgan:</span> Online - 98 cartas
                </div>
                <div class="chat-message">
                    <span class="chat-user">📊 Dra. Brennan:</span> Online - 156 cartas
                </div>
            </div>

            <div class="section-title" style="margin-top: 2rem;">💬 Chat da Equipe</div>
            <div class="chat-container" id="chatContainer">
                <div class="chat-message">
                    <span class="chat-user">👑 Reid:</span> Acabei de encontrar uma carta LENDÁRIA! 🔥
                </div>
                <div class="chat-message">
                    <span class="chat-user">🔍 Morgan:</span> Vou jogar minha carta de Interrogatório
                </div>
                <div class="chat-message">
                    <span class="chat-user">📊 Brennan:</span> Combo perfeito de evidências! +50 pontos
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" id="chatInput" placeholder="Digite sua mensagem..." maxlength="200" class="chat-input-field">
                <button id="sendButton" class="send-button" onclick="sendUserMessage()" title="Enviar mensagem (Enter)" aria-label="Enviar mensagem">
                    <span class="send-button-text">Enviar</span>
                    <span class="send-button-icon">📤</span>
                    <div class="send-button-ripple"></div>
                </button>
            </div>
        </div>

        <div class="main-area">
            <div class="section-title">
                🃏 Cartas de Investigação Ativas
            </div>
            <div class="cards-container" id="cardsContainer">
                <!-- Carta 1: Equipamento (Épica) -->
                <div class="card epic" data-type="equipment" data-rarity="epic">
                    <div class="card-icon">🔍</div>
                    <div class="card-title">EQUIPAMENTO</div>
                    <div class="card-rarity epic">ÉPICA</div>
                    <div class="card-value">
                        <div class="card-value-icon">💰</div>
                        <div class="card-value-number">90</div>
                    </div>
                    <div class="card-progress">
                        <div class="card-progress-bar" style="width: 30%"></div>
                    </div>
                    <div class="card-stat">+ 50% analise</div>
                </div>

                <!-- Carta 2: Equipamento (Rara) -->
                <div class="card rare" data-type="equipment" data-rarity="rare">
                    <div class="card-icon">📹</div>
                    <div class="card-title">EQUIPAMENTO</div>
                    <div class="card-rarity rare">RARA</div>
                    <div class="card-value">
                        <div class="card-value-icon">💰</div>
                        <div class="card-value-number">30</div>
                    </div>
                    <div class="card-progress">
                        <div class="card-progress-bar" style="width: 60%"></div>
                    </div>
                    <div class="card-stat">■ HD</div>
                </div>

                <!-- Carta 3: Aliado (Comum) -->
                <div class="card common" data-type="ally" data-rarity="common">
                    <div class="card-icon">📱</div>
                    <div class="card-title">ALIADO</div>
                    <div class="card-rarity common">COMUM</div>
                    <div class="card-value">
                        <div class="card-value-icon">💰</div>
                        <div class="card-value-number">45</div>
                    </div>
                    <div class="card-progress">
                        <div class="card-progress-bar" style="width: 25%"></div>
                    </div>
                    <div class="card-stat">Protocão</div>
                </div>

                <!-- Carta 4: Ação (Comum) -->
                <div class="card common" data-type="action" data-rarity="common">
                    <div class="card-icon">📦</div>
                    <div class="card-title">AÇÃO</div>
                    <div class="card-rarity common">COMUM</div>
                    <div class="card-value">
                        <div class="card-value-icon">💰</div>
                        <div class="card-value-number">30</div>
                    </div>
                    <div class="card-progress">
                        <div class="card-progress-bar" style="width: 25%"></div>
                    </div>
                    <div class="card-stat">Legal</div>
                </div>

                <!-- Carta 5: Evidência (Rara) -->
                <div class="card rare" data-type="evidence" data-rarity="rare">
                    <div class="card-icon">👤</div>
                    <div class="card-title">EVIDÊNCIA</div>
                    <div class="card-rarity rare">RARA</div>
                    <div class="card-value">
                        <div class="card-value-icon">💰</div>
                        <div class="card-value-number">30</div>
                    </div>
                    <div class="card-progress">
                        <div class="card-progress-bar" style="width: 25%"></div>
                    </div>
                    <div class="card-stat">Dados</div>
                </div>

                <!-- Carta 6: Testemunho (Épica) -->
                <div class="card epic" data-type="testimony" data-rarity="epic">
                    <div class="card-icon">😊</div>
                    <div class="card-title">TESTEMUNHO</div>
                    <div class="card-rarity epic">ÉPICA</div>
                    <div class="card-value">
                        <div class="card-value-icon">💰</div>
                        <div class="card-value-number">80</div>
                    </div>
                    <div class="card-progress">
                        <div class="card-progress-bar" style="width: 50%"></div>
                    </div>
                    <div class="card-stat">Testemunho</div>
                </div>
            </div>
        </div>

        <div class="sidebar">
            <div class="section-title">📊 Estatísticas</div>
            
            <!-- Estatísticas da Partida Atual -->
            <div style="margin-bottom: 1rem; padding: 0.75rem; background: rgba(15, 15, 35, 0.6); border-radius: 8px; border: 1px solid rgba(251, 191, 36, 0.3);">
                <div style="color: #fbbf24; font-size: 0.8rem; font-weight: bold; margin-bottom: 0.5rem; text-align: center;">
                    🎯 Partida Atual
                </div>
            
                <!-- Indicador Principal de Dificuldade -->
                <div id="difficultyIndicator" style="
                    margin-bottom: 1rem; 
                    padding: 0.75rem; 
                    background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.1)); 
                    border: 2px solid #f59e0b; 
                    border-radius: 10px; 
                    text-align: center;
                    box-shadow: 0 4px 15px rgba(245, 158, 11, 0.2);
                ">
                    <div style="font-size: 1.5rem; margin-bottom: 0.3rem;" id="difficultyIcon">🟡</div>
                    <div style="font-size: 0.9rem; font-weight: bold; color: #f59e0b; margin-bottom: 0.2rem;" id="difficultyName">INTERMEDIÁRIO</div>
                    <div style="font-size: 0.7rem; color: #cbd5e1; line-height: 1.3;" id="difficultyDescription">Tempo padrão, cartas balanceadas, bônus de 50%</div>
                </div>

                <!-- Evidências Coletadas -->
                <div style="margin-bottom: 0.75rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem; font-size: 0.85rem;">
                        <span>🔍 Evidências</span>
                        <span id="evidenceDisplay" style="color: #10b981; font-weight: bold;">0/100</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="evidenceProgress" style="width: 0%; background: linear-gradient(90deg, #10b981, #059669);"></div>
                    </div>
                </div>

                <div style="margin-bottom: 0.75rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem; font-size: 0.85rem;">
                        <span>Multiplicador</span>
                        <span id="currentMultiplier" style="color: #fbbf24; font-weight: bold;">1.0x</span>
                    </div>
                </div>
                
                <div style="margin-bottom: 0.75rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem; font-size: 0.85rem;">
                        <span>🃏 Cartas Jogadas</span>
                        <span id="cardsPlayed">0/6</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="cardsProgress" style="width: 0%"></div>
                    </div>
                </div>
                
                <div style="margin-bottom: 0.75rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem; font-size: 0.85rem;">
                        <span>🔥 Combo Streak</span>
                        <span id="comboStreak">0x</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="comboProgress" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Tempo Restante -->
                <div style="margin-bottom: 0.75rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.3rem; font-size: 0.85rem;">
                        <span>⏱️ Tempo Restante</span>
                        <span id="timeRemaining" style="color: #ef4444; font-weight: bold;">45:00</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="timeProgress" style="width: 100%; background: linear-gradient(90deg, #ef4444, #dc2626);"></div>
                    </div>
                </div>
            </div>





            <div class="section-title" style="margin-top: 2rem;">💰 Loja de Cartas</div>
            <div style="display: flex; flex-direction: column; gap: 0.8rem;">
                <button class="btn" onclick="buyPack('basic')">
                    📦 Pacote Básico - 100💰
                </button>
                <button class="btn" onclick="buyPack('premium')">
                    ✨ Pacote Premium - 250💰
                </button>
                <button class="btn" onclick="buyPack('legendary')">
                    🌟 Pacote Lendário - 500💰
                </button>
                </div>

            <div style="text-align: center; margin-top: 1.5rem; font-size: 1.2rem; color: #fbbf24;">
                💰 Moedas: <strong id="coin-display">500</strong>
                <div style="font-size: 0.8rem; color: #94a3b8; margin-top: 0.5rem;">
                    🎁 Ganhe moedas jogando cartas e fazendo combos!
                </div>
            </div>

            <!-- Conquistas Recentes -->
            <div class="achievements-section" style="margin-top: 2rem;">
                <div class="section-title">🏆 Conquistas Recentes</div>
                <div id="achievements-container" class="achievements-container">
                    <div class="no-achievements" id="no-achievements" style="
                        text-align: center; 
                        color: #64748b; 
                        font-size: 0.9rem; 
                        padding: 1rem;
                        font-style: italic;
                    ">
                        Jogue cartas para desbloquear conquistas! 🎯
                    </div>
                </div>
            </div>
                </div>
            </div>

    <!-- Modal para Carta Detalhada -->
    <div id="cardModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('cardModal')">&times;</span>
            <h2 style="color: #fbbf24; margin-bottom: 1.5rem;">🃏 Detalhes da Carta</h2>
            <div id="cardDetails"></div>
        </div>
    </div>

    <!-- Modal para Coleção -->
    <div id="collectionModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('collectionModal')">&times;</span>
            <h2 style="color: #fbbf24; margin-bottom: 1.5rem;">📚 Minha Coleção</h2>
            <div id="collectionContent">
                <p>Total de cartas: <strong>47/200</strong></p>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
                    <div class="mini-card">
                        <div class="mini-card-icon">🧬</div>
                        <div class="mini-card-title">DNA (L)</div>
                    </div>
                    <div class="mini-card">
                        <div class="mini-card-icon">👨‍💼</div>
                        <div class="mini-card-title">Marcus (E)</div>
                    </div>
                    <div class="mini-card">
                        <div class="mini-card-icon">🔍</div>
                        <div class="mini-card-title">Interrogatório (R)</div>
                    </div>
                    <!-- Mais cartas... -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Timer do jogo (será definido pela dificuldade)
        let gameTime = 45 * 60;
        let difficultyMultiplier = 1.0;
        let cardsPlayed = 0;
        let comboStreak = 0;
        let playerCoins = loadPlayerCoins(); // Sistema dinâmico de moedas
        
        // ========================================
        // SISTEMA COMPLETO DE MOEDAS
        // ========================================
        
        function loadPlayerCoins() {
            // Carregar moedas salvas ou começar com valor inicial
            const savedCoins = localStorage.getItem('criminalMinds_playerCoins');
            const initialCoins = savedCoins ? parseInt(savedCoins) : 500; // Valor inicial mais generoso
            return Math.max(initialCoins, 50); // Garantir mínimo de 50 moedas
        }
        
        function savePlayerCoins() {
            localStorage.setItem('criminalMinds_playerCoins', playerCoins);
            console.log(`💰 Moedas salvas: ${playerCoins}`);
        }
        
        function updateCoinDisplay() {
            const coinElement = document.getElementById('coin-display') || document.querySelector('div[style*="Moedas"] strong');
            if (coinElement) {
                coinElement.textContent = playerCoins;
                coinElement.style.color = playerCoins < 100 ? '#ff6b6b' : '#fbbf24';
                
                // Efeito visual de mudança
                coinElement.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    coinElement.style.transform = 'scale(1)';
                }, 200);
                
                console.log(`💰 Display de moedas atualizado: ${playerCoins}`);
            } else {
                console.error('💰 Elemento coin-display não encontrado');
            }
            savePlayerCoins();
        }
        
        function rewardCoins(amount, reason) {
            if (amount <= 0) return;
            
            // Aplicar multiplicador de dificuldade
            const finalAmount = Math.floor(amount * difficultyMultiplier);
            const bonusText = difficultyMultiplier > 1 ? ` (${difficultyMultiplier}x bônus!)` : '';
            
            playerCoins += finalAmount;
            updateCoinDisplay();
            
            // Verificar conquista de riqueza
            if (!achievements.wealthy.completed && playerCoins >= 1000) {
                unlockAchievement('wealthy');
            }
            
            // Feedback visual e sonoro
            showNotification(`💰 +${finalAmount} moedas! ${reason}${bonusText}`);
            addChatMessage(`💰 Ganhei ${finalAmount} moedas: ${reason}${bonusText}`, 'self');
            
            // Log para debugging
            console.log(`💰 Recompensa: +${finalAmount} moedas (${amount} x ${difficultyMultiplier}) por "${reason}". Total: ${playerCoins}`);
        }
        
        function spendCoins(amount, reason) {
            if (amount <= 0 || playerCoins < amount) return false;
            
            playerCoins -= amount;
            updateCoinDisplay();
            
            showNotification(`💸 -${amount} moedas! ${reason}`);
            addChatMessage(`💸 Gastei ${amount} moedas: ${reason}`, 'self');
            
            console.log(`💸 Gasto: -${amount} moedas (${reason}). Total: ${playerCoins}`);
            return true;
        }
        
        // Sistema de bônus diário
        function checkDailyBonus() {
            const today = new Date().toDateString();
            const lastBonus = localStorage.getItem('criminalMinds_lastDailyBonus');
            
            if (lastBonus !== today) {
                localStorage.setItem('criminalMinds_lastDailyBonus', today);
                rewardCoins(100, "Bônus diário!");
                showNotification("🎁 Bônus diário coletado! +100 moedas");
            }
        }
        
        // Sistema de recompensas por ações
        const coinRewards = {
            cardPlayed: { amount: 8, message: "Carta jogada" },
            combo3: { amount: 25, message: "Combo 3x!" },
            combo5: { amount: 50, message: "Combo 5x!" },
            combo7: { amount: 100, message: "SUPER COMBO 7x!" },
            timeBonus: { amount: 2, message: "Bônus de tempo" },
            perfectRound: { amount: 200, message: "Rodada perfeita!" },
            firstWin: { amount: 150, message: "Primeira vitória!" },
            investigation: { amount: 75, message: "Investigação completa" }
        };
        
        // Sistema de conquistas
        const achievements = {
            firstCard: { 
                reward: 20, 
                message: "Primeira carta jogada!", 
                description: "Bem-vindo ao mundo da investigação!",
                icon: "🎯",
                type: "bronze",
                completed: false 
            },
            speedPlayer: { 
                reward: 50, 
                message: "5 cartas em 1 minuto!", 
                description: "Velocidade impressionante de investigação",
                icon: "⚡",
                type: "silver",
                completed: false 
            },
            comboMaster: { 
                reward: 100, 
                message: "Combo de 10 cartas!", 
                description: "Sequência perfeita de evidências",
                icon: "🔥",
                type: "gold",
                completed: false 
            },
            investigator: { 
                reward: 150, 
                message: "20 cartas jogadas!", 
                description: "Investigador experiente e dedicado",
                icon: "🕵️",
                type: "gold",
                completed: false 
            },
            wealthy: { 
                reward: 200, 
                message: "1000 moedas acumuladas!", 
                description: "Riqueza através da investigação",
                icon: "💎",
                type: "rare",
                completed: false 
            }
        };

        // Lista de conquistas recentes para exibição
        let recentAchievements = [];

        // ========================================
        // SISTEMA DE DIFICULDADE DINÂMICA
        // ========================================
        
        let currentDifficulty = 'beginner'; // Padrão iniciante
        
        const difficultySettings = {
            beginner: { 
                cards: 6, 
                name: 'Iniciante', 
                color: '#10b981',
                icon: '🟢',
                timer: 45 * 60, // 45 minutos
                coinMultiplier: 1.0,
                evidenceMultiplier: 1.0,
                comboRequirement: 2,
                description: 'Mais tempo, menos cartas, recompensas normais'
            },
            intermediate: { 
                cards: 20, 
                name: 'Intermediário', 
                color: '#f59e0b',
                icon: '🟡',
                timer: 45 * 60, // 45 minutos
                coinMultiplier: 1.5,
                evidenceMultiplier: 1.2,
                comboRequirement: 3,
                description: 'Tempo padrão, cartas balanceadas, bônus de 50%'
            },
            hard: { 
                cards: 25, 
                name: 'Difícil', 
                color: '#ef4444',
                icon: '🔴',
                timer: 45 * 60, // 45 minutos
                coinMultiplier: 2.0,
                evidenceMultiplier: 1.5,
                comboRequirement: 4,
                description: 'Menos tempo, mais cartas, recompensas dobradas'
            }
        };

        // Base de cartas disponíveis
        const cardDatabase = [
            {
                id: 'dna-evidence',
                type: 'Evidência',
                rarity: 'legendary',
                icon: '🧬',
                title: 'DNA do Assassino',
                description: 'Perfil genético completo que revela a identidade do criminoso. 99.9% de precisão.',
                stats: ['⚡ 95', '🎯 100', '💎 Única']
            },
            {
                id: 'main-suspect',
                type: 'Suspeito',
                rarity: 'epic',
                icon: '👨‍💼',
                title: 'Marcus Thompson',
                description: 'Ex-marido violento com motivos claros. Histórico criminal extenso.',
                stats: ['⚡ 78', '🎯 85', '🔍 Perigoso']
            },
            {
                id: 'interrogation',
                type: 'Ação',
                rarity: 'rare',
                icon: '🔍',
                title: 'Interrogatório Intensivo',
                description: 'Técnica avançada que força o suspeito a revelar informações cruciais.',
                stats: ['⚡ 65', '🎯 70', '⏱️ 3 min']
            },

            {
                id: 'forensic-kit',
                type: 'Equipamento',
                rarity: 'epic',
                icon: '🔬',
                title: 'Kit Forense Avançado',
                description: 'Equipamento de alta tecnologia para análise instantânea de evidências.',
                stats: ['⚡ 85', '🎯 90', '⚗️ +50% análise']
            },
            {
                id: 'backup-officer',
                type: 'Aliado',
                rarity: 'common',
                icon: '👮‍♂️',
                title: 'Oficial de Apoio',
                description: 'Policial experiente que oferece suporte durante a investigação.',
                stats: ['⚡ 45', '🎯 55', '🛡️ Proteção']
            },
            {
                id: 'witness-testimony',
                type: 'Evidência',
                rarity: 'common',
                icon: '👁️',
                title: 'Testemunha Ocular',
                description: 'Relato detalhado de uma testemunha que viu o suspeito no local.',
                stats: ['⚡ 40', '🎯 60', '👥 Confiável']
            },
            {
                id: 'security-camera',
                type: 'Equipamento',
                rarity: 'rare',
                icon: '📹',
                title: 'Câmera de Segurança',
                description: 'Gravação de alta resolução que capturou o momento do crime.',
                stats: ['⚡ 70', '🎯 85', '📱 HD']
            },
            {
                id: 'phone-records',
                type: 'Evidência',
                rarity: 'common',
                icon: '📱',
                title: 'Registros Telefônicos',
                description: 'Histórico de chamadas que revela conexões suspeitas.',
                stats: ['⚡ 35', '🎯 50', '📊 Dados']
            },
            {
                id: 'ballistics-report',
                type: 'Evidência',
                rarity: 'epic',
                icon: '🎯',
                title: 'Relatório Balístico',
                description: 'Análise completa da arma e trajetória dos projéteis.',
                stats: ['⚡ 80', '🎯 95', '🔫 Preciso']
            },
            {
                id: 'psychological-profile',
                type: 'Ação',
                rarity: 'rare',
                icon: '🧠',
                title: 'Perfil Psicológico',
                description: 'Análise comportamental detalhada do suspeito.',
                stats: ['⚡ 55', '🎯 75', '🧠 Insight']
            },
            {
                id: 'search-warrant',
                type: 'Ação',
                rarity: 'common',
                icon: '📜',
                title: 'Mandado de Busca',
                description: 'Autorização legal para busca e apreensão de evidências.',
                stats: ['⚡ 30', '🎯 40', '⚖️ Legal']
            }
        ];



        // Função para aplicar configurações de dificuldade
        function applyDifficultySettings(difficultyConfig) {
            // Atualizar timer baseado na dificuldade
            gameTime = difficultyConfig.timer;
            difficultyMultiplier = difficultyConfig.coinMultiplier;
            
            console.log(`🎯 Aplicando configurações de dificuldade: ${difficultyConfig.name}`);
            console.log(`⏱️ Timer definido para: ${Math.floor(gameTime / 60)}:${(gameTime % 60).toString().padStart(2, '0')}`);
            console.log(`💰 Multiplicador de moedas: ${difficultyMultiplier}x`);
            
            // Atualizar display do header com informações da dificuldade
            updateDifficultyHeader(difficultyConfig);
            
            // Aplicar cor temática da dificuldade
            applyDifficultyTheme(difficultyConfig);
        }
        
        function updateDifficultyHeader(difficultyConfig) {
            // Atualizar título do caso com indicador de dificuldade
            const caseTitle = document.querySelector('.case-title');
            if (caseTitle) {
                caseTitle.innerHTML = `${difficultyConfig.icon} CRIMINAL MINDS: ${difficultyConfig.name.toUpperCase()}`;
                caseTitle.style.color = difficultyConfig.color;
            }
            
            // Atualizar timer com cor da dificuldade
            const timer = document.getElementById('gameTimer');
            if (timer) {
                timer.style.borderColor = difficultyConfig.color;
                timer.style.boxShadow = `0 0 15px ${difficultyConfig.color}40`;
            }
            
            // Atualizar indicador de dificuldade na sidebar
            updateDifficultyIndicator(difficultyConfig);
        }
        
        function updateDifficultyIndicator(difficultyConfig) {
            const indicator = document.getElementById('difficultyIndicator');
            const icon = document.getElementById('difficultyIcon');
            const name = document.getElementById('difficultyName');
            const description = document.getElementById('difficultyDescription');
            const multiplier = document.getElementById('currentMultiplier');
            
            if (indicator) {
                indicator.style.background = `linear-gradient(135deg, ${difficultyConfig.color}20, ${difficultyConfig.color}10)`;
                indicator.style.borderColor = difficultyConfig.color;
                indicator.style.boxShadow = `0 4px 15px ${difficultyConfig.color}40`;
            }
            
            if (icon) icon.textContent = difficultyConfig.icon;
            if (name) {
                name.textContent = difficultyConfig.name.toUpperCase();
                name.style.color = difficultyConfig.color;
            }
            if (description) description.textContent = difficultyConfig.description;
            if (multiplier) multiplier.textContent = `${difficultyConfig.coinMultiplier}x`;
        }
        
        function applyDifficultyTheme(difficultyConfig) {
            // Aplicar cor temática aos elementos principais
            const root = document.documentElement;
            root.style.setProperty('--difficulty-color', difficultyConfig.color);
            root.style.setProperty('--difficulty-glow', `${difficultyConfig.color}40`);
            
            // Atualizar bordas dos containers principais
            const mainArea = document.querySelector('.main-area');
            if (mainArea) {
                mainArea.style.borderColor = `${difficultyConfig.color}60`;
            }
            
            const sidebar = document.querySelector('.sidebar');
            if (sidebar) {
                sidebar.style.borderColor = `${difficultyConfig.color}40`;
            }
        }

        function generateCards() {
            const container = document.getElementById('cardsContainer');
            if (!container) return;
            
            // Obter dificuldade da URL ou usar padrão
            const urlParams = new URLSearchParams(window.location.search);
            const difficultyFromUrl = urlParams.get('difficulty') || 'easy';
            
            console.log(`🔍 URL atual: ${window.location.href}`);
            console.log(`🎯 Dificuldade da URL: ${difficultyFromUrl}`);
            
            // Mapear dificuldades da URL para as configurações existentes
            const difficultyMap = {
                'easy': 'beginner',
                'medium': 'intermediate', 
                'hard': 'hard'
            };
            
            const mappedDifficulty = difficultyMap[difficultyFromUrl] || 'intermediate';
            const difficultyConfig = difficultySettings[mappedDifficulty];
            const numCards = difficultyConfig.cards;
            
            console.log(`🗺️ Dificuldade mapeada: ${mappedDifficulty}`);
            console.log(`🃏 Número de cartas: ${numCards}`);
            console.log(`⏱️ Timer: ${Math.floor(difficultyConfig.timer / 60)} minutos`);
            console.log(`💰 Multiplicador de moedas: ${difficultyConfig.coinMultiplier}x`);
            
            // Atualizar variável global de dificuldade
            currentDifficulty = mappedDifficulty;
            
            // Aplicar configurações de dificuldade
            applyDifficultySettings(difficultyConfig);
            
            // Atualizar contador baseado no novo nível
            updateCardsCounterForLevel();
            
            // Atualizar display da dificuldade atual
            updateCurrentDifficultyDisplay(difficultyFromUrl);
            
            // Limpar cartas existentes
            container.innerHTML = '';
            
            // Aplicar classe CSS baseada na dificuldade
            container.className = `cards-container ${mappedDifficulty}`;
            
            console.log(`🎨 Aplicando classe CSS: cards-container ${mappedDifficulty}`);
            
            // Filtrar apenas cartas não jogadas
            const availableCards = cardDatabase.filter(card => !card.played);
            console.log(`🃏 Cartas disponíveis (não jogadas): ${availableCards.length} de ${cardDatabase.length} total`);
            
            // Se não há cartas disponíveis, mostrar mensagem
            if (availableCards.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #6b7280; grid-column: 1 / -1;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">🎉</div>
                        <h3 style="text-align: center; margin-bottom: 1rem;">Todas as cartas foram jogadas!</h3>
                        <p style="text-align: center; margin-bottom: 1.5rem;">Parabéns! Você utilizou todas as cartas disponíveis nesta investigação.</p>
                        <button class="btn btn-primary" onclick="showAllCards()">👁️ Ver Todas as Cartas</button>
                    </div>
                `;
                return;
            }
            
            // Embaralhar e selecionar cartas disponíveis
            const shuffledCards = [...availableCards].sort(() => Math.random() - 0.5);
            const selectedCards = shuffledCards.slice(0, Math.min(numCards, availableCards.length));
            
            console.log(`🃏 Cartas selecionadas: ${selectedCards.length} de ${availableCards.length} disponíveis`);
            
            // Gerar HTML para cada carta
            selectedCards.forEach((cardData, index) => {
                const cardElement = createCardElement(cardData);
                container.appendChild(cardElement);
                
                // Animação escalonada
                setTimeout(() => {
                    cardElement.style.opacity = '1';
                    cardElement.style.transform = 'translateY(0)';
                }, index * 100);
            });
            
            console.log(`🎯 Geradas ${selectedCards.length} cartas para dificuldade ${currentDifficulty}`);
            
            // Atualizar contador dinamicamente baseado nas cartas disponíveis
            updateDynamicCardsCounter();
        }

        function createCardElement(cardData) {
            const card = document.createElement('div');
            card.className = `card ${cardData.rarity}`;
            card.setAttribute('data-card-id', cardData.id);
            
            // Adicionar evento de clique para abrir detalhes
            card.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                showCardDetails(cardData);
            });
            
            // Iniciar invisível para animação
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            card.style.transition = 'all 0.5s ease-out';
            
            // Criar estrutura da carta com layout melhorado
            card.innerHTML = `
                <div class="card-inner">
                    <div class="card-header">
                        <span class="card-type">${cardData.type}</span>
                        <span class="card-rarity rarity-${cardData.rarity}">${getRarityName(cardData.rarity)}</span>
                    </div>
                    <div class="card-icon">${cardData.icon}</div>
                    <div class="card-title">${cardData.title}</div>
                    <div class="card-description">${cardData.description}</div>
                    <div class="card-stats">
                        ${cardData.stats ? cardData.stats.map(stat => `<div class="stat">${stat}</div>`).join('') : ''}
                    </div>
                    <div class="card-action">
                        <span class="view-details-hint">👁️ Ver Detalhes</span>
                    </div>
                </div>
            `;
            
            return card;
        }

        function showCardDetails(cardData) {
            console.log(`🔍 Abrindo detalhes da carta: ${cardData.title}`);
            
            // Verificar se a carta já foi jogada
            const isPlayed = cardData.played || false;
            
            // Fechar modal atual se existir
            closeCardDetails();
            
            // Criar modal com detalhes da carta
            const modal = document.createElement('div');
            modal.className = 'card-details-modal';
            
            // Obter informações detalhadas da carta
            const detailedDescription = getDetailedDescription(cardData);
            const investigationClues = getInvestigationClues(cardData);
            const cardEffects = getCardEffects(cardData);
            
            modal.innerHTML = `
                <div class="modal-overlay" onclick="closeCardDetails()"></div>
                <div class="modal-content card-details-content">
                    <div class="modal-header">
                        <h2>${cardData.icon} ${cardData.title}</h2>
                        <button class="close-btn" onclick="closeCardDetails()">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="card-details-header">
                            <div class="card-details-icon">${cardData.icon}</div>
                            <div class="card-details-info">
                                <h3>${cardData.title}</h3>
                                <p class="card-type">${cardData.type} - ${getRarityName(cardData.rarity)}</p>
                                <p class="card-status">${isPlayed ? '✅ Jogada' : '🃏 Disponível'}</p>
                            </div>
                        </div>
                        
                        <div class="card-details-section">
                            <h4>📝 Descrição Detalhada</h4>
                            <p>${detailedDescription}</p>
                        </div>
                        
                        <div class="card-details-section">
                            <h4>🔍 Pistas de Investigação</h4>
                            <ul class="investigation-clues">
                                ${investigationClues.map(clue => `<li>${clue}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div class="card-details-section">
                            <h4>⚡ Efeitos da Carta</h4>
                            <div class="card-effects">
                                ${cardEffects.map(effect => `<div class="effect-item">${effect}</div>`).join('')}
                            </div>
                        </div>
                        
                        <div class="card-details-section">
                            <h4>📊 Estatísticas</h4>
                            <div class="card-stats">
                                <div class="stat-item">
                                    <span class="stat-label">Evidências:</span>
                                    <span class="stat-value">${cardData.evidence || 0}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Raridade:</span>
                                    <span class="stat-value">${getRarityName(cardData.rarity)}</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">Tipo:</span>
                                    <span class="stat-value">${cardData.type}</span>
                                </div>
                                ${cardData.stats ? `
                                <div class="stat-item">
                                    <span class="stat-label">Atributos:</span>
                                    <span class="stat-value">${cardData.stats.join(', ')}</span>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        ${!isPlayed ? `
                        <div class="card-details-actions">
                            <button class="btn btn-primary" onclick="playCardFromModal('${cardData.id}')">🃏 Jogar Carta</button>
                            <button class="btn btn-secondary" onclick="closeCardDetails()">❌ Fechar</button>
                        </div>
                        ` : `
                        <div class="card-details-actions">
                            <button class="btn btn-secondary" onclick="closeCardDetails()">❌ Fechar</button>
                        </div>
                        `}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Animar entrada
            setTimeout(() => {
                modal.style.opacity = '1';
                modal.querySelector('.modal-content').style.transform = 'translate(-50%, -50%) scale(1)';
            }, 10);
        }
                    <div class="modal-header">
                        <h2>🔍 Detalhes da Carta</h2>
                        <button class="close-btn" onclick="closeCardDetails()">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="card-detail-main">
                            <div class="detail-icon">${cardData.icon}</div>
                            <div class="detail-info">
                                <h3>${cardData.title}</h3>
                                <p class="detail-type">${cardData.type}</p>
                                <p class="detail-rarity">${getRarityName(cardData.rarity)}</p>
                                ${isPlayed ? '<p class="card-status played">✅ Carta Jogada</p>' : ''}
                            </div>
                        </div>
                        <div class="card-detail-description">
                            <h4>📝 Descrição Detalhada:</h4>
                            <p>${getDetailedDescription(cardData)}</p>
                        </div>
                        <div class="card-detail-clues">
                            <h4>🔍 Pistas para Investigação:</h4>
                            <ul>${getInvestigationClues(cardData).map(clue => `<li>${clue}</li>`).join('')}</ul>
                        </div>
                        <div class="card-detail-stats">
                            <h4>📊 Estatísticas:</h4>
                            <div class="stats-grid">
                                ${cardData.stats.map(stat => `<div class="stat-item">${stat}</div>`).join('')}
                            </div>
                        </div>
                        <div class="card-actions">
                            ${!isPlayed ? `<button class="btn-play" onclick="playCardFromModal('${cardData.id}')">▶️ Jogar Carta</button>` : ''}
                            <button class="btn-close" onclick="closeCardDetails()">❌ Fechar</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Animar entrada
            setTimeout(() => {
                modal.style.opacity = '1';
                modal.querySelector('.modal-content').style.transform = 'translate(-50%, -50%) scale(1)';
            }, 10);
        }

        // Função auxiliar para mostrar detalhes por ID
        function showCardDetailsById(cardId) {
            const cardData = cardDatabase.find(card => card.id === cardId);
            if (cardData) {
                showCardDetails(cardData);
            } else {
                console.error(`❌ Carta não encontrada: ${cardId}`);
            }
        }

        function closeCardDetails() {
            const modal = document.querySelector('.card-details-modal');
            if (modal) {
                modal.style.opacity = '0';
                modal.querySelector('.modal-content').style.transform = 'translate(-50%, -50%) scale(0.8)';
                setTimeout(() => {
                    modal.remove();
                }, 300);
            }
        }

        function playCardFromModal(cardId) {
            console.log(`🃏 Jogando carta do modal: ${cardId}`);
            
            // Fechar o modal primeiro
            closeCardDetails();
            
            // Encontrar a carta no banco de dados
            const cardData = cardDatabase.find(card => card.id === cardId);
            if (!cardData) {
                console.error(`❌ Carta não encontrada no banco de dados: ${cardId}`);
                return;
            }
            
            // Verificar se a carta já foi jogada
            if (cardData.played) {
                console.log(`⚠️ Carta já foi jogada: ${cardData.title}`);
                return;
            }
            
            // Marcar carta como jogada no banco de dados
            cardData.played = true;
            console.log(`✅ Carta marcada como jogada: ${cardData.title}`);
            
            // Incrementar contadores
            cardsPlayed++;
            
            // Gerenciar Combo Streak
            manageComboStreak('increment');
            
            // Registrar tempo da última carta jogada
            window.lastCardPlayTime = Date.now();
            
            console.log(`📊 Contadores atualizados: cardsPlayed=${cardsPlayed}, comboStreak=${comboStreak}`);
            
            // Atualizar contador de cartas jogadas imediatamente
            updateCardsPlayedCounter();
            
            // Encontrar o elemento da carta no DOM e removê-lo visualmente
            setTimeout(() => {
                const cardElement = document.querySelector(`[data-card-id="${cardId}"]`);
                if (cardElement) {
                    console.log(`✅ Elemento da carta encontrado, removendo visualmente...`);
                    
                    // Aplicar animação de remoção
                    cardElement.style.animation = 'cardFadeOut 0.5s ease-out forwards';
                    setTimeout(() => {
                        cardElement.remove();
                        // Recarregar cartas disponíveis
                        generateCards();
                    }, 500);
                } else {
                    console.log(`⚠️ Elemento da carta não encontrado no DOM, mas carta foi jogada`);
                    // Recarregar cartas disponíveis mesmo sem encontrar o elemento
                    generateCards();
                }
            }, 350);
            
            // Adicionar mensagem ao chat
            setTimeout(() => {
                const chatMessages = [
                    `🃏 Carta ${cardData.title} jogada com sucesso!`,
                    `📊 Progresso: ${cardsPlayed}/20 cartas jogadas`,
                    `🎯 Combo ${comboStreak}x ativo!`,
                    `💡 Boa estratégia! ${cardData.title} foi útil!`
                ];
                
                const randomMessage = chatMessages[Math.floor(Math.random() * chatMessages.length)];
                const randomMember = teamMembers[Math.floor(Math.random() * teamMembers.length)];
                addChatMessage(randomMessage, randomMember.name.split(' ')[1]);
            }, 1000);
            
            console.log(`🎮 Carta jogada via modal: ${cardData.title}`);
        }

        function showAllCards() {
            // Criar modal com todas as cartas
            const modal = document.createElement('div');
            modal.className = 'card-details-modal';
            
            const allCards = cardDatabase.map(card => {
                const isPlayed = card.played || false;
                return `
                    <div class="all-cards-item ${isPlayed ? 'played' : ''}" onclick="showCardDetailsById('${card.id}')" style="cursor: pointer;">
                        <div class="all-cards-icon">${card.icon}</div>
                        <div class="all-cards-info">
                            <h4>${card.title}</h4>
                            <p>${card.type} - ${getRarityName(card.rarity)}</p>
                            ${isPlayed ? '<span class="played-badge">✅ Jogada</span>' : '<span class="available-badge">🃏 Disponível</span>'}
                        </div>
                        <div class="all-cards-action">
                            <span class="view-details-btn">👁️ Ver Detalhes</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            modal.innerHTML = `
                <div class="modal-overlay"></div>
                <div class="modal-content all-cards-modal">
                    <div class="modal-header">
                        <h2>👁️ Todas as Cartas</h2>
                        <button class="close-btn" onclick="closeCardDetails()">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="all-cards-grid">
                            ${allCards}
                        </div>
                        <div class="card-actions">
                            <button class="btn-close" onclick="closeCardDetails()">❌ Fechar</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Animar entrada
            setTimeout(() => {
                modal.style.opacity = '1';
                modal.querySelector('.modal-content').style.transform = 'translate(-50%, -50%) scale(1)';
            }, 10);
        }

        function getDetailedDescription(cardData) {
            const descriptions = {
                'suspect_marcus': 'Marcus Thompson, 34 anos, ex-empregado da vítima. Tinha acesso ao local do crime e estava presente no dia do assassinato. Possui histórico de conflitos com a vítima por questões financeiras.',
                'equipment_camera': 'Câmera de segurança de alta resolução que capturou imagens do momento do crime. A gravação mostra uma figura suspeita no local durante a janela de tempo do assassinato.',
                'equipment_forensic': 'Kit forense avançado com equipamentos para análise de DNA, impressões digitais e evidências microscópicas. Permite coleta e análise detalhada de evidências físicas.',
                'action_interrogation': 'Técnica de interrogatório intensivo que pode revelar inconsistências nas declarações dos suspeitos. Útil para identificar mentiras e obter confissões.',
                'action_warrant': 'Mandado de busca que permite investigar locais específicos relacionados ao caso. Pode revelar evidências escondidas ou documentos comprometedores.',
                'evidence_dna': 'Amostra de DNA encontrada na cena do crime. Análise genética pode identificar definitivamente o autor do crime.',
                'ally_officer': 'Oficial de apoio experiente que pode auxiliar na investigação. Possui conhecimento local e recursos adicionais para o caso.',
                'evidence_ballistic': 'Relatório balístico detalhado das armas e munições encontradas. Pode conectar armas específicas ao crime.',
                'action_psychological': 'Análise psicológica dos suspeitos e vítima. Pode revelar motivos, padrões comportamentais e indicar o perfil do assassino.',
                'equipment_microscope': 'Microscópio eletrônico para análise de evidências microscópicas. Pode revelar detalhes imperceptíveis a olho nu.',
                'evidence_fingerprint': 'Impressões digitais coletadas na cena do crime. Pode identificar definitivamente quem esteve no local.',
                'ally_detective': 'Detetive experiente especializado em homicídios. Possui intuição apurada e experiência em casos similares.'
            };
            
            return descriptions[cardData.id] || cardData.description;
        }



        // Função para obter efeitos da carta
        function getCardEffects(cardData) {
            const effects = {
                'suspect_marcus': [
                    '🔍 Revela informações sobre o suspeito',
                    '📊 Fornece evidências de motivação',
                    '🎯 Ajuda a identificar padrões comportamentais',
                    '⚡ Acelera a investigação'
                ],
                'equipment_camera': [
                    '📹 Captura evidências visuais',
                    '⏰ Registra horários importantes',
                    '🎯 Identifica movimentos suspeitos',
                    '📊 Fornece dados de localização'
                ],
                'equipment_forensic': [
                    '🧬 Analisa evidências de DNA',
                    '🔍 Coleta impressões digitais',
                    '⚗️ Processa amostras biológicas',
                    '📊 Gera relatórios técnicos'
                ],
                'action_interrogation': [
                    '🗣️ Revela inconsistências nas declarações',
                    '😰 Detecta sinais de nervosismo',
                    '🎭 Identifica mentiras',
                    '💡 Obtém informações cruciais'
                ],
                'action_warrant': [
                    '🏠 Permite busca em locais específicos',
                    '📱 Acesso a dispositivos eletrônicos',
                    '📄 Revela documentos comprometedores',
                    '🔍 Encontra evidências escondidas'
                ],
                'evidence_dna': [
                    '🧬 Identifica definitivamente o autor',
                    '🔗 Conecta suspeitos à cena',
                    '📊 Fornece evidência irrefutável',
                    '⚖️ Suporte para acusação'
                ],
                'ally_officer': [
                    '👮 Fornece conhecimento local',
                    '📋 Acesso a registros policiais',
                    '🤝 Contatos com informantes',
                    '🚔 Recursos adicionais de investigação'
                ],
                'evidence_ballistic': [
                    '🔫 Conecta armas ao crime',
                    '📊 Analisa trajetórias de projéteis',
                    '🔍 Identifica tipo de arma',
                    '⚖️ Evidência técnica sólida'
                ],
                'action_psychological': [
                    '🧠 Analisa perfil psicológico',
                    '🎯 Identifica motivações',
                    '📊 Revela padrões comportamentais',
                    '💡 Orienta estratégia de investigação'
                ],
                'equipment_microscope': [
                    '🔬 Analisa evidências microscópicas',
                    '🔍 Revela detalhes imperceptíveis',
                    '📊 Fornece dados técnicos precisos',
                    '⚗️ Processa amostras complexas'
                ],
                'evidence_fingerprint': [
                    '👆 Identifica quem esteve no local',
                    '🔗 Conecta suspeitos à cena',
                    '📊 Evidência de presença física',
                    '⚖️ Suporte para acusação'
                ],
                'ally_detective': [
                    '🕵️ Experiência em casos similares',
                    '💡 Intuição investigativa apurada',
                    '📊 Análise de padrões criminais',
                    '🎯 Estratégias de investigação'
                ]
            };
            
            return effects[cardData.id] || [
                '📊 Fornece informações úteis',
                '🔍 Ajuda na investigação',
                '⚡ Acelera o progresso',
                '💡 Revela pistas importantes'
            ];
        }

        function getInvestigationClues(cardData) {
            const clues = {
                'suspect_marcus': [
                    'Marcus estava desempregado e com problemas financeiros',
                    'Tinha acesso às chaves do local do crime',
                    'Sua alibi para o horário do crime é inconsistente',
                    'Possui histórico de violência doméstica',
                    'Foi visto discutindo com a vítima no dia anterior'
                ],
                'equipment_camera': [
                    'A gravação mostra uma figura masculina no local',
                    'O suspeito usava roupas escuras',
                    'A pessoa tinha aproximadamente 1,75m de altura',
                    'Movimentos sugerem conhecimento do local',
                    'Horário da gravação: 23:47 - 00:15'
                ],
                'equipment_forensic': [
                    'Permite análise de DNA encontrado na cena',
                    'Pode identificar impressões digitais',
                    'Revela evidências de luta física',
                    'Análise de manchas de sangue',
                    'Detecção de resíduos de pólvora'
                ],
                'action_interrogation': [
                    'Pode revelar inconsistências nas declarações',
                    'Técnicas de pressão psicológica',
                    'Análise de linguagem corporal',
                    'Detecção de mentiras',
                    'Pode levar a confissões'
                ],
                'action_warrant': [
                    'Permite busca na casa do suspeito',
                    'Pode revelar armas escondidas',
                    'Acesso a documentos pessoais',
                    'Busca em local de trabalho',
                    'Análise de computadores e celulares'
                ],
                'evidence_dna': [
                    'DNA masculino encontrado na vítima',
                    'Sangue do suspeito na cena',
                    'Cabelos encontrados no local',
                    'Saliva em copo na cena',
                    'Comparação com banco de dados'
                ],
                'ally_officer': [
                    'Conhecimento da área local',
                    'Acesso a registros policiais',
                    'Contatos com informantes',
                    'Experiência em patrulhamento',
                    'Recursos adicionais de investigação'
                ],
                'evidence_ballistic': [
                    'Arma calibre .38 encontrada',
                    'Munições compatíveis com ferimentos',
                    'Trajetória dos projéteis',
                    'Distância do tiro',
                    'Comparação com outras armas'
                ],
                'action_psychological': [
                    'Análise do perfil do assassino',
                    'Motivos possíveis para o crime',
                    'Padrões comportamentais',
                    'Histórico psicológico dos suspeitos',
                    'Indicadores de psicopatia'
                ],
                'equipment_microscope': [
                    'Análise de fibras de tecido',
                    'Detecção de resíduos químicos',
                    'Análise de manchas microscópicas',
                    'Identificação de materiais',
                    'Evidências de contato físico'
                ],
                'evidence_fingerprint': [
                    'Impressões digitais na arma',
                    'Digitais em superfícies da cena',
                    'Comparação com suspeitos',
                    'Identificação de visitantes',
                    'Padrões de movimento na cena'
                ],
                'ally_detective': [
                    'Experiência em casos similares',
                    'Intuição investigativa apurada',
                    'Conhecimento de padrões criminais',
                    'Técnicas avançadas de interrogatório',
                    'Rede de contatos profissionais'
                ]
            };
            
            return clues[cardData.id] || ['Informações detalhadas em análise...'];
        }

        function getRarityName(rarity) {
            const rarityNames = {
                common: 'Comum',
                rare: 'Rara',
                epic: 'Épica',
                legendary: 'Lendária'
            };
            return rarityNames[rarity] || 'Comum';
        }
        
        function checkAchievements() {
            // Primeira carta
            if (!achievements.firstCard.completed && cardsPlayed === 1) {
                unlockAchievement('firstCard');
            }
            
            // 20 cartas jogadas
            if (!achievements.investigator.completed && cardsPlayed >= 20) {
                unlockAchievement('investigator');
            }
            
            // Combo master
            if (!achievements.comboMaster.completed && comboStreak >= 10) {
                unlockAchievement('comboMaster');
            }
            
            // Wealthy
            if (!achievements.wealthy.completed && playerCoins >= 1000) {
                unlockAchievement('wealthy');
            }
        }
        
        function unlockAchievement(achievementId) {
            const achievement = achievements[achievementId];
            if (achievement && !achievement.completed) {
                achievement.completed = true;
                
                // Adicionar à lista de conquistas recentes
                const achievementData = {
                    id: achievementId,
                    ...achievement,
                    timestamp: new Date().toLocaleTimeString('pt-BR', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    })
                };
                
                recentAchievements.unshift(achievementData);
                
                // Manter apenas as 5 conquistas mais recentes
                if (recentAchievements.length > 5) {
                    recentAchievements = recentAchievements.slice(0, 5);
                }
                
                // Atualizar display de conquistas
                updateAchievementsDisplay();
                
                // Recompensa e feedback
                rewardCoins(achievement.reward, `🏆 CONQUISTA: ${achievement.message}`);
                
                // Salvar conquistas
                localStorage.setItem('criminalMinds_achievements', JSON.stringify(achievements));
                localStorage.setItem('criminalMinds_recentAchievements', JSON.stringify(recentAchievements));
                
                // Efeito especial
                showNotification(`🏆 CONQUISTA DESBLOQUEADA!\n${achievement.message}\n+${achievement.reward} moedas!`);
                
                // Efeito visual especial na conquista
                setTimeout(() => {
                    const achievementElement = document.querySelector(`[data-achievement-id="${achievementId}"]`);
                    if (achievementElement) {
                        achievementElement.style.animation = 'none';
                        achievementElement.offsetHeight; // Trigger reflow
                        achievementElement.style.animation = 'achievementSlideIn 0.6s ease-out';
                    }
                }, 100);
            }
        }
        
        function loadAchievements() {
            const saved = localStorage.getItem('criminalMinds_achievements');
            if (saved) {
                const savedAchievements = JSON.parse(saved);
                Object.assign(achievements, savedAchievements);
            }
            
            const savedRecent = localStorage.getItem('criminalMinds_recentAchievements');
            if (savedRecent) {
                recentAchievements = JSON.parse(savedRecent);
            }
            
            // Atualizar display inicial
            updateAchievementsDisplay();
        }

        function updateAchievementsDisplay() {
            const container = document.getElementById('achievements-container');
            const noAchievements = document.getElementById('no-achievements');
            
            if (!container) return;
            
            if (recentAchievements.length === 0) {
                if (noAchievements) {
                    noAchievements.style.display = 'block';
                }
                // Limpar conquistas existentes
                const existingAchievements = container.querySelectorAll('.achievement-item');
                existingAchievements.forEach(item => item.remove());
                return;
            }
            
            // Ocultar mensagem "sem conquistas"
            if (noAchievements) {
                noAchievements.style.display = 'none';
            }
            
            // Limpar conquistas existentes
            const existingAchievements = container.querySelectorAll('.achievement-item');
            existingAchievements.forEach(item => item.remove());
            
            // Adicionar conquistas recentes
            recentAchievements.forEach((achievement, index) => {
                const achievementElement = createAchievementElement(achievement);
                container.appendChild(achievementElement);
                
                // Animação escalonada para múltiplas conquistas
                setTimeout(() => {
                    achievementElement.style.opacity = '1';
                    achievementElement.style.transform = 'translateX(0)';
                }, index * 100);
            });
        }

        function createAchievementElement(achievement) {
            const element = document.createElement('div');
            element.className = `achievement-item ${achievement.type}`;
            element.setAttribute('data-achievement-id', achievement.id);
            
            element.innerHTML = `
                <div class="achievement-reward">+${achievement.reward} 💰</div>
                <div style="display: flex; align-items: flex-start;">
                    <span class="achievement-icon">${achievement.icon}</span>
                    <div style="flex: 1;">
                        <div class="achievement-title">${achievement.message}</div>
                        <div class="achievement-description">${achievement.description}</div>
                        <div class="achievement-timestamp">Desbloqueada às ${achievement.timestamp}</div>
                    </div>
                </div>
            `;
            
            // Iniciar invisível para animação
            element.style.opacity = '0';
            element.style.transform = 'translateX(-20px)';
            
            return element;
        }
        
        // ========================================
        // FUNÇÕES DE ESTATÍSTICAS POR DIFICULDADE
        // ========================================
        
        function updateCurrentDifficultyDisplay(difficulty) {
            const difficultyNames = {
                'easy': 'Iniciante',
                'medium': 'Intermediário',
                'hard': 'Difícil'
            };
            
            const currentDifficultyElement = document.getElementById('currentDifficulty');
            if (currentDifficultyElement) {
                currentDifficultyElement.textContent = difficultyNames[difficulty] || 'Intermediário';
            }
        }
        
        function loadDifficultyStats() {
            // Simular carregamento de estatísticas (em produção viria da API)
            const mockStats = {
                easy: {
                    gamesPlayed: 5,
                    gamesWon: 4,
                    winRate: '80.0',
                    bestTimeFormatted: '3:45'
                },
                medium: {
                    gamesPlayed: 12,
                    gamesWon: 8,
                    winRate: '66.7',
                    bestTimeFormatted: '5:22'
                },
                hard: {
                    gamesPlayed: 3,
                    gamesWon: 1,
                    winRate: '33.3',
                    bestTimeFormatted: '8:15'
                }
            };
            
            // Comentado temporariamente para evitar erro de elementos não encontrados
            // updateDifficultyStatsDisplay(mockStats);
            console.log('📊 Estatísticas por dificuldade carregadas (elementos não encontrados no HTML)');
        }
        
        function updateDifficultyStatsDisplay(stats) {
            console.log('📊 Tentando atualizar estatísticas por dificuldade...');
            
            // Verificar se os elementos existem antes de tentar acessá-los
            const elements = {
                easyWinRate: document.getElementById('easyWinRate'),
                easyStats: document.getElementById('easyStats'),
                easyBestTime: document.getElementById('easyBestTime'),
                mediumWinRate: document.getElementById('mediumWinRate'),
                mediumStats: document.getElementById('mediumStats'),
                mediumBestTime: document.getElementById('mediumBestTime'),
                hardWinRate: document.getElementById('hardWinRate'),
                hardStats: document.getElementById('hardStats'),
                hardBestTime: document.getElementById('hardBestTime')
            };
            
            // Atualizar apenas elementos que existem
            if (elements.easyWinRate) {
                elements.easyWinRate.textContent = stats.easy.winRate + '%';
                console.log('📊 easyWinRate atualizado');
            }
            
            if (elements.easyStats) {
                elements.easyStats.textContent = `${stats.easy.gamesWon}/${stats.easy.gamesPlayed} jogos`;
                console.log('📊 easyStats atualizado');
            }
            
            if (elements.easyBestTime) {
                elements.easyBestTime.textContent = stats.easy.bestTimeFormatted;
                console.log('📊 easyBestTime atualizado');
            }
            
            if (elements.mediumWinRate) {
                elements.mediumWinRate.textContent = stats.medium.winRate + '%';
                console.log('📊 mediumWinRate atualizado');
            }
            
            if (elements.mediumStats) {
                elements.mediumStats.textContent = `${stats.medium.gamesWon}/${stats.medium.gamesPlayed} jogos`;
                console.log('📊 mediumStats atualizado');
            }
            
            if (elements.mediumBestTime) {
                elements.mediumBestTime.textContent = stats.medium.bestTimeFormatted;
                console.log('📊 mediumBestTime atualizado');
            }
            
            if (elements.hardWinRate) {
                elements.hardWinRate.textContent = stats.hard.winRate + '%';
                console.log('📊 hardWinRate atualizado');
            }
            
            if (elements.hardStats) {
                elements.hardStats.textContent = `${stats.hard.gamesWon}/${stats.hard.gamesPlayed} jogos`;
                console.log('📊 hardStats atualizado');
            }
            
            if (elements.hardBestTime) {
                elements.hardBestTime.textContent = stats.hard.bestTimeFormatted;
                console.log('📊 hardBestTime atualizado');
            }
            
            console.log('📊 Atualização de estatísticas por dificuldade concluída');
        }
        
        function startTimer() {
            // Carregar conquistas salvas
            loadAchievements();
            
            // Comentado temporariamente para evitar erro de elementos não encontrados
            // loadDifficultyStats();
            console.log('⏱️ Timer iniciado - estatísticas por dificuldade desabilitadas');

            // FORÇAR REMOÇÃO DA SEÇÃO MINHA MÃO
            function removeHandSection() {
                const selectors = [
                    '.deck-area',
                    '.hand-cards', 
                    '.mini-card',
                    '[class*="hand"]',
                    '[id*="hand"]',
                    '[class*="mao"]',
                    '[id*="mao"]',
                    '[class*="deck"]',
                    '[id*="deck"]'
                ];
                
                selectors.forEach(selector => {
                    const elements = document.querySelectorAll(selector);
                    elements.forEach(el => {
                        if (!el.closest('.main-area')) { // Não remover cartas da área principal
                            el.remove();
                        }
                    });
                });
            }
            
            // Remover imediatamente e depois de 1 segundo
            removeHandSection();
            setTimeout(removeHandSection, 1000);
            
            // Gerar cartas iniciais
            generateCards();
            
            // Verificar bônus diário ao iniciar
            checkDailyBonus();
            
            // Atualizar display inicial de moedas
            updateCoinDisplay();
            
            // Inicializar o timer automaticamente
            startTimerInterval();
            
            // Adicionar mensagem inicial sobre o tempo
            setTimeout(() => {
                addChatMessage("⏱️ 45 minutos para resolver o caso. Boa sorte!", "Hotchner");
            }, 2000);
        }

        function calculateFinalRewards() {
            let finalBonus = 0;
            let reasons = [];
            
            // Bônus por cartas jogadas
            if (cardsPlayed >= 10) {
                finalBonus += 50;
                reasons.push("10+ cartas jogadas");
            }
            
            // Bônus por combo streak
            if (comboStreak >= 5) {
                finalBonus += coinRewards.combo5.amount;
                reasons.push("Combo 5x mantido");
            }
            
            // Bônus de conclusão
            finalBonus += coinRewards.investigation.amount;
            reasons.push("Investigação concluída");
            
            if (finalBonus > 0) {
                rewardCoins(finalBonus, reasons.join(", "));
            }
        }

        // Inicializar timer imediatamente quando a página carrega
        startTimer();
        
        // Garantir que o timer inicie imediatamente
        setTimeout(() => {
            if (!isTimerRunning) {
                console.log('🔄 Reiniciando timer...');
                startTimerInterval();
            }
        }, 100);



        function playFromHand(cardId) {
            const handCards = {
                'witness': '👁️ Testemunha interrogada! Obteve informações valiosas.',
                'phone-data': '📱 Dados do celular analisados! Últimas chamadas reveladas.',
                'ballistics': '🎯 Análise balística completa! Trajetória confirmada.',
                'surveillance': '📹 Câmeras revisadas! Suspeito identificado.',
                'profile': '🧠 Perfil psicológico atualizado! Padrão comportamental detectado.',
                'warrant': '📜 Mandado executado! Evidências legalmente obtidas.'
            };

            const effect = handCards[cardId] || 'Carta da mão jogada!';

            // Remover carta da mão (efeito visual)
            event.currentTarget.style.animation = 'cardAppear 0.5s ease-out reverse';
            setTimeout(() => {
                event.currentTarget.style.opacity = '0.3';
                event.currentTarget.style.pointerEvents = 'none';
            }, 500);
            
            // Recompensa por jogar carta da mão (bônus extra)
            rewardCoins(coinRewards.cardPlayed.amount + 3, "Carta da mão jogada");
            
            showNotification(effect);
            addChatMessage(`🃏 Da mão: ${effect}`, 'self');

            // Atualizar estatísticas
            cardsPlayed++;
            comboStreak++;
            
            // Sistema de recompensas por combo (também para cartas da mão)
            if (comboStreak === 3) {
                rewardCoins(coinRewards.combo3.amount, coinRewards.combo3.message);
            } else if (comboStreak === 5) {
                rewardCoins(coinRewards.combo5.amount, coinRewards.combo5.message);
            } else if (comboStreak >= 7) {
                rewardCoins(coinRewards.combo7.amount, coinRewards.combo7.message);
            }
            
            updateStats();
            
            // Verificar conquistas
            checkAchievements();
        }

        function showCardEffect(effect) {
            // Criar popup de efeito da carta
            const popup = document.createElement('div');
            popup.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #1a1a2e, #16213e);
                border: 3px solid #fbbf24;
                border-radius: 20px;
                padding: 2rem;
                z-index: 3000;
                text-align: center;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
                animation: cardAppear 0.6s ease-out;
            `;
            
            popup.innerHTML = `
                <h3 style="color: #fbbf24; margin-bottom: 1rem; font-size: 1.5rem;">${effect.title}</h3>
                <p style="color: #cbd5e1; margin-bottom: 1rem; font-size: 1.1rem;">${effect.effect}</p>
                <p style="color: #6b7280; font-style: italic;">${effect.sound}</p>
                <button class="btn" onclick="this.parentElement.remove()" style="margin-top: 1.5rem;">✨ Continuar</button>
            `;
            
            document.body.appendChild(popup);
            
            // Remover automaticamente após 5 segundos
            setTimeout(() => {
                if (popup.parentElement) {
                    popup.remove();
                }
            }, 5000);
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #fbbf24, #f59e0b);
                color: #0f0f23;
                padding: 1rem 1.5rem;
                border-radius: 12px;
                font-weight: 600;
                z-index: 2000;
                box-shadow: 0 10px 30px rgba(251, 191, 36, 0.4);
                animation: cardAppear 0.5s ease-out;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'cardAppear 0.5s ease-out reverse';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }



        // Funções do deck
        function drawCard() {
            const newCards = [
                '🔍 Lupa Mágica',
                '📋 Relatório Forense',
                '🎭 Disfarce',
                '💡 Inspiração',
                '🔐 Chave Mestra'
            ];
            
            const randomCard = newCards[Math.floor(Math.random() * newCards.length)];
            showNotification(`🎴 Nova carta: ${randomCard}`);
            addChatMessage(`🎴 Comprei: ${randomCard}`, 'self');
        }

        function shuffleDeck() {
            showNotification('🔀 Deck embaralhado! Novas possibilidades disponíveis.');
            addChatMessage('🔀 Embaralhei meu deck', 'self');
        }

        function useCombo() {
            if (comboStreak >= 3) {
                // Recompensa baseada no nível do combo
                let comboReward = 0;
                let comboMessage = '';
                
                if (comboStreak >= 7) {
                    comboReward = coinRewards.combo7.amount;
                    comboMessage = coinRewards.combo7.message;
                } else if (comboStreak >= 5) {
                    comboReward = coinRewards.combo5.amount;
                    comboMessage = coinRewards.combo5.message;
                } else {
                    comboReward = coinRewards.combo3.amount;
                    comboMessage = coinRewards.combo3.message;
                }
                
                // Bônus extra por usar combo manualmente
                comboReward += 25;
                
                rewardCoins(comboReward, `${comboMessage} (Ativação manual)`);
                showNotification(`⚡ COMBO ATIVADO! +${comboReward} moedas!`);
                addChatMessage(`⚡ Usei combo devastador! +${comboReward} moedas`, 'self');
                
                comboStreak = 0;
                updateStats();
            } else {
                showNotification('❌ Combo insuficiente. Precisa de pelo menos 3 cartas em sequência.');
            }
        }

        // Loja de cartas
        function buyPack(packType) {
            const packs = {
                'basic': { cost: 100, cards: 3, rares: 0 },
                'premium': { cost: 250, cards: 5, rares: 1 },
                'legendary': { cost: 500, cards: 8, rares: 3 }
            };
            
            const pack = packs[packType];
            
            if (spendCoins(pack.cost, `Pacote ${packType}`)) {
                showNotification(`📦 Pacote ${packType} comprado! ${pack.cards} cartas obtidas!`);
                addChatMessage(`💰 Comprei pacote ${packType}! ${pack.cards} novas cartas`, 'self');
                
                // Simular abertura de pacote com possível moeda bônus
                if (packType === 'legendary' && Math.random() < 0.3) {
                    rewardCoins(50, "Carta rara encontrada no pacote!");
                }
            } else {
                showNotification(`❌ Moedas insuficientes! Você tem ${playerCoins}, precisa de ${pack.cost}.`);
            }
        }


        
        function showMessageSuccess() {
            const success = document.createElement('div');
            success.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #10b981, #059669);
                color: white;
                padding: 0.8rem 1.5rem;
                border-radius: 12px;
                font-weight: 600;
                z-index: 3000;
                box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
                animation: slideIn 0.3s ease-out;
            `;
            success.innerHTML = '✅ Mensagem enviada!';
            
            document.body.appendChild(success);
            
            setTimeout(() => {
                success.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => success.remove(), 300);
            }, 2000);
        }



        // Modais
        function openDeck() {
            alert('🃏 Sistema de deck em desenvolvimento! Em breve você poderá personalizar completamente seu baralho.');
        }

        function showCollection() {
            document.getElementById('collectionModal').style.display = 'block';
        }

        function makeAccusation() {
            const confirmAccusation = confirm('⚖️ Tem certeza que deseja fazer sua acusação final?\n\n🃏 Suas cartas jogadas determinarão o resultado.\n\n✅ Clique OK para fazer a acusação\n❌ Clique Cancelar para continuar investigando');
            
            if (confirmAccusation) {
                // Calcular resultado baseado nas cartas jogadas
                const success = Math.random() > 0.5; // Simulação simples (50% chance)
                
                // Bônus final baseado no desempenho
                calculateFinalRewards();
                
                // Mostrar resultado final
                showGameEndModal(success ? 'win' : 'lose');
            }
        }

        function exitGame() {
            const confirmExit = confirm('🚪 Tem certeza que deseja sair do jogo?\n\n⚠️ Todo o progresso não salvo será perdido.\n\n✅ Clique OK para sair\n❌ Clique Cancelar para continuar jogando');
            
            if (confirmExit) {
                // Parar o timer se estiver rodando
                if (window.simpleGameTimer) {
                    window.simpleGameTimer.stop();
                }
                
                // Limpar dados temporários
                localStorage.removeItem('criminalMinds_timerStarted');
                localStorage.removeItem('criminalMinds_timerStartTime');
                
                // Salvar estatísticas finais
                const exitData = {
                    exitTime: new Date().toISOString(),
                    cardsPlayed: cardsPlayed || 0,
                    playerCoins: playerCoins || 0,
                    timeRemaining: gameTime || 0,
                    reason: 'user_exit'
                };
                
                localStorage.setItem('criminalMinds_exitData', JSON.stringify(exitData));
                
                // Redirecionar para o lobby
                window.location.href = 'lobby.html';
            }
        }

        // Função para mostrar modal de fim de jogo
        function showGameEndModal(result) {
            let title, message, icon, color;
            
            switch(result) {
                case 'win':
                    title = '🎉 CASO RESOLVIDO!';
                    message = 'Parabéns! Você desvendou o mistério e capturou o criminoso!';
                    icon = '🏆';
                    color = '#10b981';
                    break;
                case 'lose':
                    title = '❌ CASO ARQUIVADO';
                    message = 'Sua acusação estava incorreta. O criminoso escapou desta vez...';
                    icon = '💔';
                    color = '#ef4444';
                    break;
                case 'timeout':
                    title = '⏰ TEMPO ESGOTADO';
                    message = 'O tempo acabou! O caso foi encerrado sem solução definitiva.';
                    icon = '⌛';
                    color = '#f59e0b';
                    break;
                default:
                    title = '🏁 FIM DE JOGO';
                    message = 'A investigação chegou ao fim.';
                    icon = '🎮';
                    color = '#6b7280';
            }
            
            // Salvar progresso e estatísticas
            const gameData = {
                result: result,
                cardsPlayed: cardsPlayed,
                comboStreak: comboStreak,
                playerCoins: playerCoins,
                timeRemaining: gameTime,
                endTime: new Date().toISOString()
            };
            
            localStorage.setItem('criminalMinds_lastGameResult', JSON.stringify(gameData));
            
            // Criar modal de resultado
            const resultModal = document.createElement('div');
            resultModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 5000;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: linear-gradient(135deg, #1a1a2e, #16213e);
                border: 3px solid ${color};
                border-radius: 25px;
                padding: 3rem;
                text-align: center;
                max-width: 500px;
                width: 90%;
                box-shadow: 0 30px 80px rgba(0, 0, 0, 0.8);
                animation: modalSlideIn 0.5s ease-out;
            `;
            
            modalContent.innerHTML = `
                <div style="font-size: 4rem; margin-bottom: 1rem;">${icon}</div>
                <h2 style="color: ${color}; font-size: 2rem; margin-bottom: 1rem;">${title}</h2>
                <p style="color: #cbd5e1; font-size: 1.1rem; margin-bottom: 2rem; line-height: 1.6;">${message}</p>
                
                <div style="background: rgba(0, 0, 0, 0.3); border-radius: 15px; padding: 1.5rem; margin-bottom: 2rem;">
                    <h3 style="color: #fbbf24; margin-bottom: 1rem;">📊 Resumo da Investigação</h3>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; font-size: 0.9rem;">
                        <div style="color: #94a3b8;">🃏 Cartas Jogadas: <span style="color: #fbbf24; font-weight: bold;">${cardsPlayed}</span></div>
                        <div style="color: #94a3b8;">⚡ Combo Máximo: <span style="color: #fbbf24; font-weight: bold;">${comboStreak}x</span></div>
                        <div style="color: #94a3b8;">💰 Moedas Ganhas: <span style="color: #fbbf24; font-weight: bold;">${playerCoins}</span></div>
                        <div style="color: #94a3b8;">⏱️ Tempo Restante: <span style="color: #fbbf24; font-weight: bold;">${Math.floor(gameTime / 60)}:${(gameTime % 60).toString().padStart(2, '0')}</span></div>
                    </div>
                </div>
                
                <div style="color: #6b7280; font-style: italic; margin-bottom: 1.5rem;">Retornando ao lobby em <span id="countdown">5</span> segundos...</div>
                <button onclick="returnToLobby()" style="
                    background: linear-gradient(135deg, #fbbf24, #f59e0b);
                    color: #0f0f23;
                    border: none;
                    padding: 1rem 2rem;
                    border-radius: 10px;
                    font-weight: bold;
                    font-size: 1rem;
                    cursor: pointer;
                    transition: all 0.3s ease;
                " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    🏠 Voltar ao Lobby Agora
                </button>
            `;
            
            // Adicionar animação CSS
            const style = document.createElement('style');
            style.textContent = `
                @keyframes modalSlideIn {
                    from { opacity: 0; transform: translateY(-50px) scale(0.9); }
                    to { opacity: 1; transform: translateY(0) scale(1); }
                }
            `;
            document.head.appendChild(style);
            
            resultModal.appendChild(modalContent);
            document.body.appendChild(resultModal);
            
            // Countdown automático
            let countdown = 5;
            const countdownElement = document.getElementById('countdown');
            const countdownInterval = setInterval(() => {
                countdown--;
                if (countdownElement) {
                    countdownElement.textContent = countdown;
                }
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    returnToLobby();
                }
            }, 1000);
        }
        
        function returnToLobby() {
            window.location.href = 'lobby.html';
        }

        // Função para sair da investigação
        function exitInvestigation() {
            // Mostrar modal de confirmação
            const confirmExit = confirm('🚪 Tem certeza que deseja sair da investigação?\n\n⚠️ Seu progresso atual será salvo, mas você perderá o timer atual.\n\n✅ Clique OK para voltar ao lobby\n❌ Clique Cancelar para continuar jogando');
            
            if (confirmExit) {
                // Salvar progresso antes de sair
                const gameData = {
                    cardsPlayed: cardsPlayed,
                    comboStreak: comboStreak,
                    playerCoins: playerCoins,
                    exitTime: new Date().toISOString(),
                    timeRemaining: gameTime
                };
                
                localStorage.setItem('criminalMinds_gameProgress', JSON.stringify(gameData));
                
                // Mostrar feedback de saída
                const exitFeedback = document.createElement('div');
                exitFeedback.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: linear-gradient(135deg, #1a1a2e, #16213e);
                    border: 3px solid #fbbf24;
                    border-radius: 20px;
                    padding: 2rem;
                    z-index: 4000;
                    text-align: center;
                    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
                    color: white;
                `;
                
                exitFeedback.innerHTML = `
                    <h3 style="color: #fbbf24; margin-bottom: 1rem;">🚪 Saindo da Investigação...</h3>
                    <p style="color: #cbd5e1; margin-bottom: 1rem;">✅ Progresso salvo com sucesso!</p>
                    <p style="color: #6b7280; font-style: italic;">Redirecionando para o lobby...</p>
                `;
                
                document.body.appendChild(exitFeedback);
                
                // Redirecionar após 2 segundos
                setTimeout(() => {
                    window.location.href = 'lobby.html';
                }, 2000);
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Fechar modal clicando fora
        window.onclick = function(event) {
            const modals = ['cardModal', 'collectionModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // SISTEMA DE CHAT DA EQUIPE
        let chatMessages = [];
        let teamMembers = [
            { name: 'Detetive Reid', status: 'Online', cards: 127, avatar: '🧠' },
            { name: 'Agente Morgan', status: 'Online', cards: 98, avatar: '💪' },
            { name: 'Dra. Brennan', status: 'Online', cards: 156, avatar: '🔬' },
            { name: 'Garcia', status: 'Online', cards: 203, avatar: '💻' },
            { name: 'Hotchner', status: 'Online', cards: 89, avatar: '👔' }
        ];

        // Simulação de atividade da equipe
        function simulateTeamActivity() {
            const activities = [
                { message: "🎴 Joguei carta LENDÁRIA: Perfil Completo!", author: "Reid" },
                { message: "⚡ Ativei combo de 5 cartas! +50 pontos", author: "Morgan" },
                { message: "💎 Encontrei carta ÉPICA rara!", author: "Brennan" },
                { message: "🔥 Comprei pacote premium!", author: "Garcia" },
                { message: "✨ Desbloqueei conquista especial!", author: "Hotchner" },
                { message: "🔍 Nova evidência coletada!", author: "Reid" },
                { message: "📊 Progresso: 75% das evidências", author: "Morgan" },
                { message: "🎯 Suspeito identificado!", author: "Brennan" },
                { message: "💡 Ideia brilhante para o caso!", author: "Garcia" },
                { message: "🚨 Alerta: Tempo acabando!", author: "Hotchner" }
            ];
            
            setInterval(() => {
                if (Math.random() < 0.3) {
                    const activity = activities[Math.floor(Math.random() * activities.length)];
                    addChatMessage(activity.message, activity.author);
                }
            }, 10000);
        }

        // Função para adicionar mensagem ao chat
        function addChatMessage(message, author) {
            const chatContainer = document.getElementById('chatMessages');
            if (!chatContainer) return;

            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';
            
            const timestamp = new Date().toLocaleTimeString('pt-BR', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            const member = teamMembers.find(m => m.name.includes(author)) || { avatar: '👤' };
            
            messageDiv.innerHTML = `
                <div class="chat-message-header">
                    <span class="chat-user">${member.avatar} ${author}:</span>
                    <span class="chat-time">${timestamp}</span>
                </div>
                <div class="chat-content">${message}</div>
            `;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Limitar mensagens (manter apenas as últimas 20)
            const messages = chatContainer.querySelectorAll('.chat-message');
            if (messages.length > 20) {
                messages[0].remove();
            }
        }

        // Função para enviar mensagem do usuário com feedback visual
        function sendUserMessage() {
            const input = document.getElementById('chatInput');
            const sendButton = document.getElementById('sendButton');
            const message = input.value.trim();
            
            if (message) {
                // Feedback visual no botão
                sendButton.style.transform = 'scale(0.95)';
                sendButton.innerHTML = '<span class="send-button-text">Enviando...</span><span class="send-button-icon">⏳</span><div class="send-button-ripple"></div>';
                sendButton.disabled = true;
                sendButton.classList.add('highlight');
                
                // Feedback visual no input
                input.style.borderColor = '#10b981';
                input.style.boxShadow = '0 0 20px rgba(16, 185, 129, 0.4)';
                
                setTimeout(() => {
                    // Restaurar botão
                    sendButton.innerHTML = '<span class="send-button-text">Enviar</span><span class="send-button-icon">📤</span><div class="send-button-ripple"></div>';
                    sendButton.disabled = false;
                    sendButton.style.transform = '';
                    sendButton.classList.remove('highlight');
                    
                    // Restaurar input
                    input.style.borderColor = '';
                    input.style.boxShadow = '';
                    
                    // Adicionar mensagem
                    const detectiveName = localStorage.getItem('detectiveName') || 'Detetive';
                    addChatMessage(message, detectiveName);
                    input.value = '';
                    
                    // Efeito de sucesso
                    showMessageSuccess();
                    
                }, 300);
                
                // Simular resposta da equipe após 2-5 segundos
                setTimeout(() => {
                    const responses = [
                        "Entendi! Boa observação! 👍",
                        "Vou investigar isso! 🔍",
                        "Excelente ponto! 👏",
                        "Concordo totalmente! 💯",
                        "Vamos focar nessa pista! 🎯",
                        "Boa estratégia! 🚀",
                        "Perfeito! Continue assim! ✨",
                        "Vou verificar isso! 🔎"
                    ];
                    
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    const randomMember = teamMembers[Math.floor(Math.random() * teamMembers.length)];
                    addChatMessage(randomResponse, randomMember.name.split(' ')[1]); // Usar apenas o sobrenome
                }, 2300 + Math.random() * 3000);
            } else {
                // Feedback para mensagem vazia
                input.style.borderColor = '#ef4444';
                input.style.boxShadow = '0 0 20px rgba(239, 68, 68, 0.4)';
                input.placeholder = 'Digite algo antes de enviar...';
                
                setTimeout(() => {
                    input.style.borderColor = '';
                    input.style.boxShadow = '';
                    input.placeholder = 'Digite sua mensagem...';
                }, 2000);
            }
        }

        // Função para inicializar o chat
        function initializeChat() {
            const chatInput = document.getElementById('chatInput');
            const sendButton = document.getElementById('sendButton');
            
            if (chatInput) {
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendUserMessage();
                    }
                });
            }
            
            if (sendButton) {
                sendButton.addEventListener('click', sendUserMessage);
            }
            
            // Adicionar mensagens iniciais
            setTimeout(() => {
                addChatMessage("🔍 Iniciando investigação...", "Reid");
            }, 1000);
            
            setTimeout(() => {
                addChatMessage("💪 Pronto para ação!", "Morgan");
            }, 2000);
            
            setTimeout(() => {
                addChatMessage("🔬 Laboratório preparado!", "Brennan");
            }, 3000);
        }

        // Inicializar
        simulateTeamActivity();
        
        // Inicializar contador baseado no nível atual
        initializeCardsCounter();

        // SISTEMA DE CARTAS INTERATIVAS COMPLETO
        // Variáveis já declaradas anteriormente, apenas inicializando valores
        cardsPlayed = 0;
        comboStreak = 0;
        playerCoins = 500;
        let totalEvidence = 0;
        let currentCase = {
            id: 'case-001',
            title: 'Assassinato no Condomínio Luxo',
            description: 'Uma mulher foi encontrada morta em seu apartamento. Todas as portas estavam trancadas por dentro.',
            targetEvidence: 100,
            collectedEvidence: 0,
            suspects: ['Marcus Thompson', 'João Silva', 'Maria Santos'],
            clues: []
        };

        // Configuração das cartas com evidências específicas
        const cardEffects = {
            interrogation: {
                evidence: 8,
                description: 'Revelou informações sobre o relacionamento conturbado da vítima',
                clue: 'Vítima tinha problemas com ex-marido'
            },
            forensic: {
                evidence: 12,
                description: 'Encontrou fibras de tecido e impressões digitais',
                clue: 'Impressões digitais de pessoa conhecida'
            },
            surveillance: {
                evidence: 5,
                description: 'Câmeras mostraram entrada e saída de pessoas',
                clue: 'Suspeito visto no local na noite do crime'
            },
            search: {
                evidence: 10,
                description: 'Encontrou objetos pessoais e documentos',
                clue: 'Documentos financeiros comprometedores'
            },
            psychology: {
                evidence: 15,
                description: 'Análise revelou padrão comportamental do assassino',
                clue: 'Assassino tem conhecimento da vítima'
            },
            dna: {
                evidence: 20,
                description: 'DNA encontrado na cena do crime',
                clue: 'DNA corresponde a um dos suspeitos'
            },
            witness: {
                evidence: 6,
                description: 'Testemunha viu atividade suspeita',
                clue: 'Barulhos estranhos na noite do crime'
            },
            cameras: {
                evidence: 9,
                description: 'Gravações revelaram movimentação suspeita',
                clue: 'Pessoa não identificada no elevador'
            },
            database: {
                evidence: 11,
                description: 'Histórico criminal revelou antecedentes',
                clue: 'Suspeito tem histórico de violência'
            }
        };

        // Função para jogar uma carta
        function playCard(cardElement) {
            console.log('🃏 Função playCard chamada');
            
            if (!cardElement) {
                console.error('🃏 Erro: cardElement é null ou undefined');
                return;
            }
            
            if (cardElement.classList.contains('played')) {
                console.log('🃏 Carta já foi jogada, mostrando feedback visual');
                // Feedback visual para carta já jogada
                cardElement.style.animation = 'cardShake 0.3s ease-in-out';
                setTimeout(() => {
                    cardElement.style.animation = '';
                }, 300);
                return; // Carta já foi jogada
            }
            
            // Verificar se já atingiu o limite de cartas para o nível atual
            const maxCardsForLevel = difficultySettings[currentDifficulty].cards;
            if (cardsPlayed >= maxCardsForLevel) {
                console.log(`🃏 Limite de cartas atingido: ${cardsPlayed}/${maxCardsForLevel}`);
                // Feedback visual para limite atingido
                cardElement.style.animation = 'cardShake 0.3s ease-in-out';
                setTimeout(() => {
                    cardElement.style.animation = '';
                }, 300);
                
                // Mostrar notificação
                showLimitNotification();
                return; // Não permitir jogar mais cartas
            }

            const cardType = cardElement.getAttribute('data-type');
            console.log(`🃏 Tipo da carta: ${cardType}`);
            
            const cardEffect = cardEffects[cardType];
            
            if (!cardEffect) {
                console.error('🃏 Tipo de carta não encontrado:', cardType);
                return;
            }
            
            console.log(`🃏 Efeito da carta encontrado: ${cardEffect.evidence} evidências`);

            // Animação de ativação da carta
            cardElement.style.animation = 'cardPulse 0.3s ease-in-out';
            setTimeout(() => {
                cardElement.style.animation = '';
            }, 300);

            // Marcar carta como jogada
            cardElement.classList.add('played');
            
            // Marcar no banco de dados da carta
            const cardId = cardElement.getAttribute('data-card-id');
            if (cardId) {
                const cardData = cardDatabase.find(card => card.id === cardId);
                if (cardData) {
                    cardData.played = true;
                }
            }
            
            // Remover carta do container após animação
            setTimeout(() => {
                cardElement.style.animation = 'cardFadeOut 0.5s ease-out forwards';
                setTimeout(() => {
                    cardElement.remove();
                    // Verificar se ainda há cartas disponíveis
                    const remainingCards = document.querySelectorAll('.card:not(.played)');
                    if (remainingCards.length === 0) {
                        // Todas as cartas foram jogadas, mostrar mensagem
                        const container = document.getElementById('cardsContainer');
                        if (container) {
                            container.innerHTML = `
                                <div style="text-align: center; padding: 2rem; color: #6b7280; grid-column: 1 / -1;">
                                    <div style="font-size: 3rem; margin-bottom: 1rem;">🎉</div>
                                    <h3 style="text-align: center; margin-bottom: 1rem;">Todas as cartas foram jogadas!</h3>
                                    <p style="text-align: center; margin-bottom: 1.5rem;">Parabéns! Você utilizou todas as cartas disponíveis nesta investigação.</p>
                                    <button class="btn btn-primary" onclick="showAllCards()">👁️ Ver Todas as Cartas</button>
                                </div>
                            `;
                        }
                    }
                }, 500);
            }, 1000);
            
            // === ATUALIZAÇÕES DO JOGO ===
            
            // 1. Incrementar contadores
            cardsPlayed++;
            
            // Gerenciar Combo Streak
            manageComboStreak('increment');
            
            // Registrar tempo da última carta jogada
            window.lastCardPlayTime = Date.now();
            
            console.log(`🃏 Contadores atualizados: cardsPlayed=${cardsPlayed}, comboStreak=${comboStreak}`);
            
            // Atualizar contador de cartas jogadas imediatamente
            updateCardsPlayedCounter();
            
            // Forçar atualização adicional após um pequeno delay
            setTimeout(() => {
                console.log('🔄 Forçando atualização adicional do contador...');
                updateCardsPlayedCounter();
            }, 100);
            
            // Forçar atualização direta do elemento
            setTimeout(() => {
                console.log('🔧 Forçando atualização direta...');
                const element = document.getElementById('cardsPlayed');
                if (element) {
                    const maxCards = difficultySettings[currentDifficulty].cards;
                    element.textContent = `${cardsPlayed}/${maxCards}`;
                    console.log('✅ Atualização direta realizada');
                } else {
                    console.log('❌ Elemento não encontrado para atualização direta');
                }
            }, 200);
            
            // 2. Atualizar sistema de evidências
            updateEvidenceDisplay();
            const evidenceCalculation = calculateTotalEvidence();
            console.log(`🃏 Sistema de evidências atualizado: ${evidenceCalculation.total} total`);
            
            // 4. Adicionar pista ao caso
            if (!currentCase.clues.includes(cardEffect.clue)) {
                currentCase.clues.push(cardEffect.clue);
            }
            
            // 5. Adicionar moedas baseado no combo
            const baseCoins = 10;
            const comboBonus = Math.floor(comboStreak * 2);
            const totalCoins = baseCoins + comboBonus;
            playerCoins += totalCoins;
            
            // 6. Atualizar display de moedas
            updateCoinDisplay();
            
            // 7. Salvar moedas no localStorage
            savePlayerCoins();
            
            // === ATUALIZAÇÕES VISUAIS ===
            
            // 8. Atualizar todas as estatísticas do jogo de forma síncrona
            updateAllGameStats();
            
            // 9. Mostrar feedback visual da carta
            const evidenceGained = evidenceCalculation.total - (totalEvidence - cardEffect.evidence);
            showCardPlayedFeedback(cardElement, evidenceGained, cardEffect.description);
            
            // 10. Mostrar notificação de evidências e moedas
            showEvidenceNotification(evidenceGained, cardEffect.description, totalCoins, comboStreak);
            
            // 12. Efeito sonoro visual (emoji)
            const soundEffect = document.createElement('div');
            soundEffect.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 2rem;
                z-index: 1000;
                animation: cardPlayedAnim 1s ease-out forwards;
                pointer-events: none;
            `;
            soundEffect.textContent = '🔍';
            cardElement.appendChild(soundEffect);
            
            setTimeout(() => {
                soundEffect.remove();
            }, 1000);
            
            // === ATUALIZAÇÕES DO CHAT ===
            
            // 13. Adicionar mensagem ao chat sobre a evidência coletada
            setTimeout(() => {
                const evidenceGained = evidenceCalculation.total - (totalEvidence - cardEffect.evidence);
                const chatMessages = [
                    `🔍 Coletou ${evidenceGained} evidências com ${cardEffect.description.toLowerCase()}`,
                    `📊 Progresso: ${evidenceCalculation.total}/${currentCase.targetEvidence} evidências`,
                    `🎯 Combo ${comboStreak}x ativo! Continue assim!`,
                    `💡 Boa estratégia! Essa evidência é crucial!`,
                    `🃏 Carta ${cardType} jogada com sucesso!`,
                    `⚡ Combo ${comboStreak}x multiplicando evidências!`,
                    `💰 +${totalCoins} moedas ganhas!`,
                    `🎯 Pista adicionada: ${cardEffect.clue}`
                ];
                
                const randomMessage = chatMessages[Math.floor(Math.random() * chatMessages.length)];
                const randomMember = teamMembers[Math.floor(Math.random() * teamMembers.length)];
                addChatMessage(randomMessage, randomMember.name.split(' ')[1]);
            }, 1000);
            
            // 14. Adicionar mensagem específica sobre o tipo de carta
            setTimeout(() => {
                const cardTypeMessages = {
                    'equipment': '🔧 Equipamento utilizado com eficiência!',
                    'evidence': '🔍 Evidência crucial coletada!',
                    'action': '⚡ Ação executada com precisão!',
                    'ally': '🤝 Aliado forneceu informações valiosas!',
                    'suspect': '👤 Suspeito interrogado com sucesso!'
                };
                
                const typeMessage = cardTypeMessages[cardType] || '🃏 Carta jogada com sucesso!';
                addChatMessage(typeMessage, 'Sistema');
            }, 2000);
            
            // === VERIFICAÇÕES FINAIS ===
            
            // 15. Verificar se atingiu objetivo de evidências
            if (currentCase.collectedEvidence >= currentCase.targetEvidence) {
                setTimeout(() => {
                    showGameEndModal('victory');
                }, 1500);
            }
            
            // 16. Log final para debug
            console.log(`🎮 Jogo atualizado: ${cardsPlayed} cartas jogadas, ${comboStreak}x combo, ${currentCase.collectedEvidence}/${currentCase.targetEvidence} evidências, ${playerCoins} moedas`);
            
        }

        // Função para atualizar o progresso visual das cartas
        function updateCardProgress() {
            const availableCards = cardDatabase.filter(card => !card.played).length;
            const maxCards = Math.max(difficultySettings[currentDifficulty].cards, availableCards);
            const playedCards = cardDatabase.filter(card => card.played).length;
            const progressPercentage = (playedCards / maxCards) * 100;

            // Atualizar título da seção com progresso
            const sectionTitle = document.querySelector('.section-title');
            if (sectionTitle) {
                sectionTitle.innerHTML = `🃏 Cartas de Investigação Ativas <span style="font-size: 0.8rem; color: #10b981;">(${availableCards} disponíveis)</span>`;
            }

            // Adicionar barra de progresso se não existir
            let progressBar = document.getElementById('cards-progress-bar');
            if (!progressBar) {
                progressBar = document.createElement('div');
                progressBar.id = 'cards-progress-bar';
                progressBar.style.cssText = `
                    width: 100%;
                    height: 4px;
                    background: rgba(107, 114, 128, 0.3);
                    border-radius: 2px;
                    margin: 1rem 0;
                    overflow: hidden;
                `;
                
                const progressFill = document.createElement('div');
                progressFill.id = 'cards-progress-fill';
                progressFill.style.cssText = `
                    height: 100%;
                    background: linear-gradient(90deg, #10b981, #059669);
                    border-radius: 2px;
                    transition: width 0.5s ease;
                    width: 0%;
                `;
                
                progressBar.appendChild(progressFill);
                const cardsContainer = document.getElementById('cardsContainer');
                if (cardsContainer && cardsContainer.parentNode) {
                    cardsContainer.parentNode.insertBefore(progressBar, cardsContainer);
                }
            }

            // Atualizar barra de progresso
            const progressFill = document.getElementById('cards-progress-fill');
            if (progressFill) {
                progressFill.style.width = `${progressPercentage}%`;
            }
        }

        // Função para mostrar feedback visual ao jogar carta
        function showCardPlayedFeedback(cardElement, evidenceGained, description) {
            const feedback = document.createElement('div');
            feedback.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #10b981, #059669);
                color: white;
                padding: 0.8rem 1.2rem;
                border-radius: 25px;
                font-weight: bold;
                font-size: 1rem;
                z-index: 1000;
                animation: cardPlayedAnim 1.5s ease-out forwards;
                text-align: center;
                box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
            `;
            feedback.innerHTML = `
                <div style="font-size: 1.2rem; margin-bottom: 0.3rem;">🔍</div>
                <div style="font-size: 0.9rem;">+${evidenceGained} Evidências</div>
                <div style="font-size: 0.7rem; opacity: 0.9; margin-top: 0.2rem;">${description}</div>
            `;
            
            cardElement.style.position = 'relative';
            cardElement.appendChild(feedback);
            
            setTimeout(() => {
                feedback.remove();
            }, 1500);
        }

        // Função para recarregar cartas disponíveis
        function reloadAvailableCards() {
            console.log('🔄 Recarregando cartas disponíveis...');
            generateCards();
        }

        // Função para atualizar todas as estatísticas do jogo de forma síncrona
        function updateAllGameStats() {
            console.log('🎮 Atualizando todas as estatísticas do jogo...');
            
            // 1. Atualizar estatísticas principais
            updateStats();
            
            // 2. Atualizar display de moedas
            updateCoinDisplay();
            
            // 3. Atualizar progresso das cartas
            updateCardProgress();
            
            // 4. Atualizar título do caso
            const caseTitle = document.querySelector('.case-title');
            if (caseTitle) {
                caseTitle.innerHTML = `🔍 ${currentCase.title} <span style="font-size: 0.8rem; color: #10b981;">(${currentCase.collectedEvidence}/${currentCase.targetEvidence})</span>`;
            }
            
            // 5. Verificar conquistas
            checkAchievements();
            
            // 6. Garantir que o contador de cartas jogadas seja atualizado
            updateCardsPlayedCounter();
            
            // 7. Forçar atualização agressiva dos contadores
            forceUpdateCounters();
            
            console.log('✅ Todas as estatísticas do jogo atualizadas');
        }
        
        // Função para inicializar o contador baseado no nível atual
        function initializeCardsCounter() {
            const maxCards = difficultySettings[currentDifficulty].cards;
            const cardsElement = document.getElementById('cardsPlayed');
            if (cardsElement) {
                cardsElement.textContent = `0/${maxCards}`;
                console.log(`🎯 Contador inicializado: 0/${maxCards} para nível ${currentDifficulty}`);
            }
            
            // Inicializar barra de progresso
            updateCardsProgressBar(maxCards);
        }
        
        // Função para atualizar contador quando o nível muda
        function updateCardsCounterForLevel() {
            const maxCards = difficultySettings[currentDifficulty].cards;
            const cardsElement = document.getElementById('cardsPlayed');
            if (cardsElement) {
                cardsElement.textContent = `${cardsPlayed}/${maxCards}`;
                console.log(`🎯 Contador atualizado para nível ${currentDifficulty}: ${cardsPlayed}/${maxCards}`);
            }
            
            // Atualizar barra de progresso
            updateCardsProgressBar(maxCards);
        }
        
        // Função para atualizar a barra de progresso das cartas
        function updateCardsProgressBar(maxCards) {
            const progressPercentage = (cardsPlayed / maxCards) * 100;
            const progressElement = document.getElementById('cardsProgress');
            
            if (progressElement) {
                progressElement.style.width = `${progressPercentage}%`;
                console.log(`📊 Barra de progresso atualizada: ${cardsPlayed}/${maxCards} = ${progressPercentage.toFixed(1)}%`);
                
                // Adicionar efeito visual de animação
                progressElement.style.transition = 'width 0.5s ease-out';
                progressElement.style.backgroundColor = progressPercentage >= 100 ? '#10b981' : '#fbbf24';
            }
        }
        
        // Função para detectar dinamicamente o total de cartas disponíveis
        function updateDynamicCardsCounter() {
            const availableCards = cardDatabase.filter(card => !card.played).length;
            const maxCards = Math.max(difficultySettings[currentDifficulty].cards, availableCards);
            const cardsElement = document.getElementById('cardsPlayed');
            if (cardsElement) {
                cardsElement.textContent = `${cardsPlayed}/${maxCards}`;
                console.log(`🎯 Contador dinâmico: ${cardsPlayed}/${maxCards} (disponíveis: ${availableCards})`);
            }
            
            // Atualizar barra de progresso dinamicamente
            updateCardsProgressBar(maxCards);
        }
        
        // Função para forçar atualização agressiva dos contadores
        function forceUpdateCounters() {
            console.log('💪 Forçando atualização agressiva dos contadores...');
            
            // Usar contador dinâmico
            updateDynamicCardsCounter();
            
            // Forçar atualização do contador de cartas jogadas
            const cardsElement = document.getElementById('cardsPlayed');
            if (cardsElement) {
                cardsElement.style.color = '#fbbf24';
                cardsElement.style.fontWeight = 'bold';
                console.log(`💪 Contador forçado com valor dinâmico`);
            }
            
            // Forçar atualização do multiplicador
            const multiplierElement = document.getElementById('currentMultiplier');
            if (multiplierElement) {
                const multiplier = 1.0 + (comboStreak * 0.1);
                multiplierElement.textContent = `${multiplier.toFixed(1)}x`;
                console.log(`💪 Multiplicador forçado: ${multiplier.toFixed(1)}x`);
            }
            
            // Forçar atualização do combo streak
            const comboElement = document.getElementById('comboStreak');
            if (comboElement) {
                comboElement.textContent = `${comboStreak}x`;
                console.log(`💪 Combo forçado: ${comboStreak}x`);
            }
            
            // Buscar e atualizar qualquer elemento com /20
            const allElements = document.querySelectorAll('*');
            const maxCards = difficultySettings[currentDifficulty].cards;
            allElements.forEach(element => {
                if (element.textContent && element.textContent.includes('/20') && !element.textContent.includes('Evidências')) {
                    element.textContent = `${cardsPlayed}/${maxCards}`;
                    console.log(`💪 Elemento encontrado e atualizado: ${element.tagName} ${element.id || element.className}`);
                }
            });
        }

        // Função específica para atualizar o contador de cartas jogadas e multiplicador
        function updateCardsPlayedCounter() {
            // Usar contador dinâmico em vez de fixo
            updateDynamicCardsCounter();
            return;
            
            const maxCards = difficultySettings[currentDifficulty].cards;
            console.log(`🃏 Atualizando contador de cartas jogadas: ${cardsPlayed}/${maxCards}`);
            
            // === ATUALIZAR CONTADOR DE CARTAS JOGADAS ===
            
            // Busca direta e simples
            let cardsPlayedElement = document.getElementById('cardsPlayed');
            
            if (!cardsPlayedElement) {
                console.log('🔍 Elemento não encontrado por ID, buscando por texto...');
                
                // Buscar por texto específico
                const allSpans = document.querySelectorAll('span');
                cardsPlayedElement = Array.from(allSpans).find(span => 
                    span.textContent.includes('/20') && !span.textContent.includes('Evidências')
                );
            }
            
            if (!cardsPlayedElement) {
                console.log('🔍 Buscando por contexto...');
                
                // Buscar próximo ao texto "Cartas Jogadas"
                const cartasJogadasText = Array.from(document.querySelectorAll('span')).find(span => 
                    span.textContent.includes('Cartas Jogadas')
                );
                if (cartasJogadasText && cartasJogadasText.parentNode) {
                    const siblings = Array.from(cartasJogadasText.parentNode.children);
                    cardsPlayedElement = siblings.find(sibling => 
                        sibling.textContent.includes('/20') && sibling !== cartasJogadasText
                    );
                }
            }
            
            if (cardsPlayedElement) {
                console.log(`✅ Elemento cardsPlayed encontrado: "${cardsPlayedElement.textContent}"`);
                cardsPlayedElement.textContent = `${cardsPlayed}/${maxCards}`;
                console.log(`✅ Contador de cartas jogadas atualizado: ${cardsPlayed}/${maxCards}`);
                
                // Adicionar efeito visual de atualização
                cardsPlayedElement.style.transform = 'scale(1.1)';
                cardsPlayedElement.style.color = '#fbbf24';
                setTimeout(() => {
                    cardsPlayedElement.style.transform = 'scale(1)';
                    cardsPlayedElement.style.color = '';
                }, 200);
                
                // Forçar reflow do DOM
                cardsPlayedElement.offsetHeight;
                
            } else {
                console.error('❌ Elemento cardsPlayed não encontrado!');
                
                // Debug completo: listar todos os elementos
                console.log('🔍 DEBUG COMPLETO - Todos os elementos span:');
                const allSpans = document.querySelectorAll('span');
                allSpans.forEach((span, index) => {
                    console.log(`🔍 Span ${index}: id="${span.id}" text="${span.textContent}"`);
                });
                
                // Tentar criar o elemento se não existir
                console.log('🔧 Tentando criar elemento cardsPlayed dinamicamente...');
                const sidebar = document.querySelector('.sidebar') || document.querySelector('[class*="sidebar"]');
                if (sidebar) {
                    const newElement = document.createElement('span');
                    newElement.id = 'cardsPlayed';
                    newElement.textContent = `${cardsPlayed}/20`;
                    newElement.style.color = '#fbbf24';
                    newElement.style.fontWeight = 'bold';
                    sidebar.appendChild(newElement);
                    console.log('✅ Elemento cardsPlayed criado dinamicamente');
                }
            }
            
            // === ATUALIZAR MULTIPLICADOR ===
            
            // Calcular multiplicador baseado no combo streak
            const multiplier = 1.0 + (comboStreak * 0.1);
            console.log(`📊 Calculando multiplicador: 1.0 + (${comboStreak} * 0.1) = ${multiplier.toFixed(1)}x`);
            
            // Buscar o elemento específico pelo ID exato
            let multiplierElement = document.getElementById('currentMultiplier');
            
            if (multiplierElement) {
                console.log(`✅ Elemento currentMultiplier encontrado: "${multiplierElement.textContent}"`);
                multiplierElement.textContent = `${multiplier.toFixed(1)}x`;
                console.log(`✅ Multiplicador atualizado: ${multiplier.toFixed(1)}x`);
                
                // Adicionar efeito visual de atualização
                multiplierElement.style.transform = 'scale(1.1)';
                multiplierElement.style.color = '#fbbf24';
                setTimeout(() => {
                    multiplierElement.style.transform = 'scale(1)';
                    multiplierElement.style.color = '#fbbf24'; // Manter cor original
                }, 200);
            } else {
                console.error('❌ Elemento currentMultiplier não encontrado!');
                
                // Debug: listar todos os elementos span para encontrar o multiplicador
                const allSpans = document.querySelectorAll('span');
                console.log('🔍 Procurando elemento multiplicador...');
                allSpans.forEach((span, index) => {
                    if (span.textContent.includes('x') && span.textContent.includes('1.')) {
                        console.log(`🔍 Possível multiplicador ${index}: id="${span.id}" text="${span.textContent}"`);
                    }
                });
                
                // Tentar encontrar por texto
                const multiplierTextElements = Array.from(document.querySelectorAll('span')).filter(span => 
                    span.textContent.includes('1.0x') || span.textContent.includes('1x')
                );
                
                if (multiplierTextElements.length > 0) {
                    multiplierElement = multiplierTextElements[0];
                    console.log(`🔧 Multiplicador encontrado por texto: "${multiplierElement.textContent}"`);
                    multiplierElement.textContent = `${multiplier.toFixed(1)}x`;
                    console.log(`✅ Multiplicador atualizado via busca por texto: ${multiplier.toFixed(1)}x`);
                }
            }
            
            // === ATUALIZAR BARRA DE PROGRESSO DAS CARTAS ===
            
            const cardsProgress = (cardsPlayed / maxCards) * 100;
            const cardsProgressElement = document.getElementById('cardsProgress');
            
            if (cardsProgressElement) {
                cardsProgressElement.style.width = `${cardsProgress}%`;
                console.log(`📊 Barra de progresso de cartas atualizada: ${cardsProgress}%`);
            } else {
                console.error('📊 Elemento cardsProgress não encontrado');
            }
            
            // === ATUALIZAR BARRA DE PROGRESSO DO COMBO ===
            
            const comboProgress = Math.min((comboStreak / 10) * 100, 100);
            const comboProgressElement = document.getElementById('comboProgress');
            
            if (comboProgressElement) {
                comboProgressElement.style.width = `${comboProgress}%`;
                console.log(`📊 Barra de progresso de combo atualizada: ${comboProgress}%`);
            } else {
                console.error('📊 Elemento comboProgress não encontrado');
            }
            
            // === VERIFICAÇÃO FINAL ===
            
            // Verificar se as atualizações foram aplicadas
            setTimeout(() => {
                const finalCardsElement = document.getElementById('cardsPlayed');
                const finalMultiplierElement = document.getElementById('currentMultiplier');
                
                if (finalCardsElement) {
                    console.log(`✅ Verificação final - Cartas jogadas: "${finalCardsElement.textContent}"`);
                }
                
                if (finalMultiplierElement) {
                    console.log(`✅ Verificação final - Multiplicador: "${finalMultiplierElement.textContent}"`);
                }
            }, 100);
        }

        // Função para mostrar notificação de vitória
        function showVictoryNotification() {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #10b981, #059669);
                color: white;
                padding: 2rem;
                border-radius: 15px;
                text-align: center;
                z-index: 10000;
                box-shadow: 0 10px 30px rgba(16, 185, 129, 0.5);
                animation: victoryPulse 2s ease-in-out;
            `;
            
            notification.innerHTML = `
                <div style="font-size: 3rem; margin-bottom: 1rem;">🎉</div>
                <h2 style="margin: 0 0 1rem 0; font-size: 1.5rem;">VITÓRIA!</h2>
                <p style="margin: 0 0 1rem 0; font-size: 1.1rem;">Você coletou todas as evidências necessárias!</p>
                <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">Total: ${currentCase.collectedEvidence}/${currentCase.targetEvidence} evidências</p>
                <button onclick="this.parentElement.remove()" style="
                    margin-top: 1rem;
                    padding: 0.5rem 1rem;
                    background: rgba(255, 255, 255, 0.2);
                    border: none;
                    border-radius: 8px;
                    color: white;
                    cursor: pointer;
                    font-weight: bold;
                ">Continuar</button>
            `;
            
            document.body.appendChild(notification);
            
            // Adicionar animação CSS
            const style = document.createElement('style');
            style.textContent = `
                @keyframes victoryPulse {
                    0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
                    50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
                    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            // Remover automaticamente após 5 segundos
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }

        // Função para mostrar notificação de evidências e moedas
        function showEvidenceNotification(evidence, description, coins, combo) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #1e40af, #3b82f6);
                color: white;
                padding: 1.2rem;
                border-radius: 12px;
                font-weight: bold;
                z-index: 2000;
                animation: slideInRight 0.5s ease-out;
                box-shadow: 0 8px 25px rgba(30, 64, 175, 0.4);
                max-width: 300px;
            `;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <span style="font-size: 1.2rem;">🔍</span>
                    <span style="font-size: 1.1rem;">+${evidence} Evidências</span>
                </div>
                <div style="font-size: 0.8rem; opacity: 0.9; margin-bottom: 0.5rem; line-height: 1.3;">
                    ${description}
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem;">
                    <span>💰 +${coins} Moedas</span>
                    <span>🔥 Combo ${combo}x</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.5s ease-in';
                setTimeout(() => notification.remove(), 500);
            }, 4000);
        }

        // ===== SISTEMA DE COMBO STREAK =====
        
        // Função para gerenciar o Combo Streak
        function manageComboStreak(action = 'increment') {
            console.log(`🔥 Gerenciando Combo Streak: ${action}`);
            
            switch (action) {
                case 'increment':
                    comboStreak++;
                    console.log(`🔥 Combo incrementado: ${comboStreak}x`);
                    
                    // Verificar conquistas de combo
                    if (comboStreak === 3) {
                        showNotification('🔥 Combo 3x! Bônus de evidências ativo!');
                    } else if (comboStreak === 5) {
                        showNotification('⚡ Combo 5x! Multiplicador máximo!');
                    } else if (comboStreak === 10) {
                        showNotification('🎯 Combo 10x! LENDÁRIO!');
                        // Desbloquear conquista
                        unlockAchievement('comboMaster');
                    }
                    break;
                    
                case 'reset':
                    const previousCombo = comboStreak;
                    comboStreak = 0;
                    console.log(`🔥 Combo resetado: ${previousCombo}x → 0x`);
                    
                    if (previousCombo >= 3) {
                        showNotification('💔 Combo perdido! Volte a jogar cartas consecutivamente.');
                    }
                    break;
                    
                case 'maintain':
                    console.log(`🔥 Combo mantido: ${comboStreak}x`);
                    break;
            }
            
            // Atualizar display do combo
            updateComboDisplay();
            
            // Atualizar multiplicador
            updateMultiplier();
            
            // Atualizar barra de progresso do combo
            updateComboProgressBar();
            
            return comboStreak;
        }
        
        // Função para atualizar o display do combo
        function updateComboDisplay() {
            const comboElement = document.getElementById('comboStreak');
            if (comboElement) {
                comboElement.textContent = `${comboStreak}x`;
                
                // Aplicar cores baseadas no nível do combo
                if (comboStreak >= 10) {
                    comboElement.style.color = '#fbbf24'; // Dourado
                    comboElement.style.textShadow = '0 0 10px #fbbf24';
                } else if (comboStreak >= 7) {
                    comboElement.style.color = '#ef4444'; // Vermelho
                    comboElement.style.textShadow = '0 0 8px #ef4444';
                } else if (comboStreak >= 5) {
                    comboElement.style.color = '#8b5cf6'; // Roxo
                    comboElement.style.textShadow = '0 0 6px #8b5cf6';
                } else if (comboStreak >= 3) {
                    comboElement.style.color = '#f59e0b'; // Laranja
                    comboElement.style.textShadow = '0 0 4px #f59e0b';
                } else {
                    comboElement.style.color = '#6b7280'; // Cinza
                    comboElement.style.textShadow = 'none';
                }
                
                console.log(`🔥 Display do combo atualizado: ${comboStreak}x`);
            } else {
                console.error('🔥 Elemento comboStreak não encontrado');
            }
        }
        
        // Função para atualizar o multiplicador baseado no combo
        function updateMultiplier() {
            const multiplier = 1.0 + (comboStreak * 0.1); // 10% por combo
            const multiplierElement = document.getElementById('currentMultiplier');
            
            if (multiplierElement) {
                multiplierElement.textContent = `${multiplier.toFixed(1)}x`;
                
                // Aplicar cores baseadas no multiplicador
                if (multiplier >= 2.0) {
                    multiplierElement.style.color = '#fbbf24'; // Dourado
                } else if (multiplier >= 1.5) {
                    multiplierElement.style.color = '#ef4444'; // Vermelho
                } else if (multiplier >= 1.3) {
                    multiplierElement.style.color = '#8b5cf6'; // Roxo
                } else {
                    multiplierElement.style.color = '#6b7280'; // Cinza
                }
                
                console.log(`📈 Multiplicador atualizado: ${multiplier.toFixed(1)}x`);
            } else {
                console.error('📈 Elemento currentMultiplier não encontrado');
            }
            
            return multiplier;
        }
        
        // Função para atualizar a barra de progresso do combo
        function updateComboProgressBar() {
            const maxCombo = 10; // Combo máximo
            const progressPercentage = Math.min((comboStreak / maxCombo) * 100, 100);
            const progressElement = document.getElementById('comboProgress');
            
            if (progressElement) {
                progressElement.style.width = `${progressPercentage}%`;
                
                // Aplicar cores baseadas no progresso
                if (progressPercentage >= 100) {
                    progressElement.style.backgroundColor = '#fbbf24'; // Dourado
                } else if (progressPercentage >= 70) {
                    progressElement.style.backgroundColor = '#ef4444'; // Vermelho
                } else if (progressPercentage >= 50) {
                    progressElement.style.backgroundColor = '#8b5cf6'; // Roxo
                } else if (progressPercentage >= 30) {
                    progressElement.style.backgroundColor = '#f59e0b'; // Laranja
                } else {
                    progressElement.style.backgroundColor = '#10b981'; // Verde
                }
                
                console.log(`📊 Barra de progresso do combo atualizada: ${progressPercentage.toFixed(1)}%`);
            } else {
                console.error('📊 Elemento comboProgress não encontrado');
            }
        }
        
        // Função para calcular bônus de evidências baseado no combo
        function calculateComboBonus(baseEvidence) {
            const comboMultiplier = 1 + (comboStreak * 0.1); // 10% por combo
            const totalEvidence = Math.floor(baseEvidence * comboMultiplier);
            const bonusEvidence = totalEvidence - baseEvidence;
            
            console.log(`🔥 Bônus de combo: ${baseEvidence} + ${bonusEvidence} = ${totalEvidence} evidências`);
            
            return {
                base: baseEvidence,
                bonus: bonusEvidence,
                total: totalEvidence,
                multiplier: comboMultiplier
            };
        }

        // Função para calcular total de evidências baseado na dificuldade
        function calculateTotalEvidence() {
            const difficultyConfig = difficultySettings[currentDifficulty];
            const baseEvidencePerCard = 10; // Evidências base por carta
            const maxCards = difficultyConfig.cards;
            
            // Calcular evidências base
            let totalBaseEvidence = cardsPlayed * baseEvidencePerCard;
            
            // Aplicar bônus de combo
            const comboBonus = calculateComboBonus(totalBaseEvidence);
            
            // Aplicar multiplicador de dificuldade
            const difficultyMultiplier = difficultyConfig.evidenceMultiplier || 1.0;
            const finalEvidence = Math.floor(comboBonus.total * difficultyMultiplier);
            
            console.log(`📊 Total de evidências calculado: ${totalBaseEvidence} base + ${comboBonus.bonus} combo = ${finalEvidence} final`);
            
            return {
                base: totalBaseEvidence,
                combo: comboBonus.bonus,
                total: finalEvidence,
                multiplier: difficultyMultiplier,
                maxCards: maxCards
            };
        }

        // Função para atualizar display de evidências
        function updateEvidenceDisplay() {
            const evidenceCalculation = calculateTotalEvidence();
            
            // Atualizar variável global
            totalEvidence = evidenceCalculation.total;
            currentCase.collectedEvidence = evidenceCalculation.total;
            
            // Atualizar display
            const evidenceDisplayElement = document.getElementById('evidenceDisplay');
            if (evidenceDisplayElement) {
                evidenceDisplayElement.textContent = `${evidenceCalculation.total}/${currentCase.targetEvidence}`;
                console.log(`📊 Display de evidências atualizado: ${evidenceCalculation.total}/${currentCase.targetEvidence}`);
            }
            
            // Atualizar barra de progresso
            const evidenceProgress = Math.min((evidenceCalculation.total / currentCase.targetEvidence) * 100, 100);
            const evidenceProgressElement = document.getElementById('evidenceProgress');
            if (evidenceProgressElement) {
                evidenceProgressElement.style.width = `${evidenceProgress}%`;
                
                // Mudar cor baseado no progresso
                if (evidenceProgress >= 100) {
                    evidenceProgressElement.style.background = 'linear-gradient(90deg, #10b981, #059669)';
                } else if (evidenceProgress >= 75) {
                    evidenceProgressElement.style.background = 'linear-gradient(90deg, #f59e0b, #d97706)';
                } else if (evidenceProgress >= 50) {
                    evidenceProgressElement.style.background = 'linear-gradient(90deg, #3b82f6, #2563eb)';
                } else {
                    evidenceProgressElement.style.background = 'linear-gradient(90deg, #6b7280, #4b5563)';
                }
                
                console.log(`📊 Barra de progresso de evidências atualizada: ${evidenceProgress}%`);
            }
            
            // Verificar se atingiu o objetivo
            if (evidenceCalculation.total >= currentCase.targetEvidence) {
                showVictoryNotification();
            }
            
            return evidenceCalculation;
        }
        
        // Função para calcular bônus de moedas baseado no combo
        function calculateComboCoins() {
            const baseCoins = 5; // Moedas base por carta
            const comboBonus = Math.floor(comboStreak * 2); // +2 moedas por combo
            const totalCoins = baseCoins + comboBonus;
            
            console.log(`💰 Bônus de moedas por combo: ${baseCoins} + ${comboBonus} = ${totalCoins} moedas`);
            
            return {
                base: baseCoins,
                bonus: comboBonus,
                total: totalCoins
            };
        }
        
        // Função para verificar se o combo deve ser resetado
        function shouldResetCombo() {
            // Resetar combo se:
            // 1. Passou muito tempo desde a última carta jogada (5 segundos)
            // 2. Houve um erro ao jogar carta
            // 3. O jogador clicou em "Ver Todas as Cartas"
            
            const lastCardTime = window.lastCardPlayTime || 0;
            const currentTime = Date.now();
            const timeSinceLastCard = currentTime - lastCardTime;
            
            if (timeSinceLastCard > 5000) { // 5 segundos
                console.log('🔥 Combo resetado por timeout (5s)');
                return true;
            }
            
            return false;
        }
        
        // Função para atualizar estatísticas
        function updateStats() {
            console.log('📊 Atualizando estatísticas...');
            
            // Atualizar cartas jogadas
            const cardsPlayedElement = document.getElementById('cardsPlayed');
            if (cardsPlayedElement) {
                const maxCards = difficultySettings[currentDifficulty].cards;
                cardsPlayedElement.textContent = `${cardsPlayed}/${maxCards}`;
                console.log(`📊 Cartas jogadas atualizadas: ${cardsPlayed}/${maxCards}`);
            } else {
                console.error('📊 Elemento cardsPlayed não encontrado');
            }
            
            const comboStreakElement = document.getElementById('comboStreak');
            if (comboStreakElement) {
                comboStreakElement.textContent = `${comboStreak}x`;
                console.log(`📊 Combo atualizado: ${comboStreak}x`);
            } else {
                console.error('📊 Elemento comboStreak não encontrado');
            }
            
            // Atualizar evidências usando o novo sistema
            updateEvidenceDisplay();
            
            // Calcular multiplicador baseado na dificuldade
            const difficultyMultiplier = 1.0 + (comboStreak * 0.1);
            const currentMultiplierElement = document.getElementById('currentMultiplier');
            if (currentMultiplierElement) {
                currentMultiplierElement.textContent = `${difficultyMultiplier.toFixed(1)}x`;
                console.log(`📊 Multiplicador atualizado: ${difficultyMultiplier.toFixed(1)}x`);
            } else {
                console.error('📊 Elemento currentMultiplier não encontrado');
            }
            
            // Atualizar barras de progresso
            const maxCards = difficultySettings[currentDifficulty].cards;
            const cardsProgress = (cardsPlayed / maxCards) * 100;
            const comboProgress = Math.min((comboStreak / 10) * 100, 100);
            const cardsProgressElement = document.getElementById('cardsProgress');
            if (cardsProgressElement) {
                cardsProgressElement.style.width = `${cardsProgress}%`;
                console.log(`📊 Barra de progresso de cartas atualizada: ${cardsProgress}%`);
            } else {
                console.error('📊 Elemento cardsProgress não encontrado');
            }
            
            const comboProgressElement = document.getElementById('comboProgress');
            if (comboProgressElement) {
                comboProgressElement.style.width = `${comboProgress}%`;
                console.log(`📊 Barra de progresso de combo atualizada: ${comboProgress}%`);
            } else {
                console.error('📊 Elemento comboProgress não encontrado');
            }
            
            // Atualizar título do caso com progresso
            const caseTitle = document.querySelector('.case-title');
            if (caseTitle) {
                caseTitle.innerHTML = `🔍 ${currentCase.title} <span style="font-size: 0.8rem; color: #10b981;">(${currentCase.collectedEvidence}/${currentCase.targetEvidence})</span>`;
            }
        }

        // Adicionar event listeners para as cartas
        function initializeCards() {
            console.log('🃏 Inicializando sistema de cartas...');
            const cards = document.querySelectorAll('.card');
            console.log(`🃏 Encontradas ${cards.length} cartas para inicializar`);
            
            cards.forEach((card, index) => {
                console.log(`🃏 Inicializando carta ${index + 1}: ${card.getAttribute('data-type')}`);
                
                // Remover event listeners anteriores para evitar duplicação
                card.removeEventListener('click', () => playCard(card));
                card.removeEventListener('mouseenter', (e) => showCardTooltip(e, card));
                card.removeEventListener('mouseleave', hideCardTooltip);
                
                // Adicionar novos event listeners
                card.addEventListener('click', () => {
                    console.log(`🃏 Carta clicada: ${card.getAttribute('data-type')}`);
                    playCard(card);
                });
                
                // Adicionar tooltip ao passar o mouse
                card.addEventListener('mouseenter', (e) => showCardTooltip(e, card));
                card.addEventListener('mouseleave', hideCardTooltip);
                
                // Adicionar classe para indicar que está inicializada
                card.classList.add('initialized');
            });
            
            console.log('🃏 Sistema de cartas inicializado com sucesso!');
        }

        // Função para mostrar tooltip da carta
        function showCardTooltip(event, cardElement) {
            if (cardElement.classList.contains('played')) {
                return; // Não mostrar tooltip para cartas já jogadas
            }

            const cardType = cardElement.getAttribute('data-type');
            const cardEffect = cardEffects[cardType];
            
            if (!cardEffect) return;

            const tooltip = document.createElement('div');
            tooltip.id = 'card-tooltip';
            tooltip.style.cssText = `
                position: fixed;
                background: linear-gradient(135deg, #1a1a2e, #16213e);
                border: 2px solid rgba(251, 191, 36, 0.6);
                border-radius: 12px;
                padding: 1rem;
                color: white;
                font-size: 0.9rem;
                z-index: 3000;
                max-width: 250px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8);
                backdrop-filter: blur(10px);
                animation: cardAppear 0.3s ease-out;
            `;

            tooltip.innerHTML = `
                <div style="color: #fbbf24; font-weight: bold; margin-bottom: 0.5rem;">
                    ${cardElement.querySelector('.card-title').textContent}
                </div>
                <div style="color: #cbd5e1; margin-bottom: 0.5rem;">
                    ${cardElement.querySelector('.card-description').textContent}
                </div>
                <div style="color: #10b981; font-weight: bold;">
                    🔍 +${cardEffect.evidence} Evidências Base
                </div>
                <div style="color: #f59e0b; font-size: 0.8rem; margin-top: 0.5rem;">
                    💡 Pista: ${cardEffect.clue}
                </div>
            `;

            document.body.appendChild(tooltip);

            // Posicionar tooltip
            const rect = cardElement.getBoundingClientRect();
            tooltip.style.left = rect.right + 10 + 'px';
            tooltip.style.top = rect.top + 'px';
        }

        // Função para esconder tooltip
        function hideCardTooltip() {
            const tooltip = document.getElementById('card-tooltip');
            if (tooltip) {
                tooltip.remove();
            }
        }

        // SISTEMA DE TEMPO RESTANTE COMPLETO
        // gameTime já declarado anteriormente
        let timerInterval;
        let isTimerRunning = false;

        // Função para atualizar o tempo em tempo real
        function updateTimeDisplay() {
            const timeRemainingElement = document.getElementById('timeRemaining');
            const timeProgressElement = document.getElementById('timeProgress');
            const headerTimerElement = document.getElementById('gameTimer');
            
            if (timeRemainingElement && timeProgressElement) {
                const minutes = Math.floor(gameTime / 60);
                const seconds = gameTime % 60;
                const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Atualizar display na seção de estatísticas
                timeRemainingElement.textContent = timeString;
                
                // Atualizar timer no header
                if (headerTimerElement) {
                    headerTimerElement.textContent = `⏱️ ${timeString}`;
                }
                
                // Atualizar barra de progresso do tempo
                const timeProgress = (gameTime / (45 * 60)) * 100; // 45 minutos = 2700 segundos
                timeProgressElement.style.width = `${timeProgress}%`;
                
                // Mudar cor baseado no tempo restante
                if (gameTime <= 300) { // 5 minutos restantes - VERMELHO
                    timeProgressElement.style.background = 'linear-gradient(90deg, #dc2626, #991b1b)';
                    timeRemainingElement.style.color = '#dc2626';
                    timeRemainingElement.style.animation = 'pulse 1s infinite';
                    showTimeWarning('CRÍTICO: Menos de 5 minutos!');
                } else if (gameTime <= 900) { // 15 minutos restantes - LARANJA
                    timeProgressElement.style.background = 'linear-gradient(90deg, #f59e0b, #d97706)';
                    timeRemainingElement.style.color = '#f59e0b';
                    timeRemainingElement.style.animation = 'none';
                    if (gameTime === 900) showTimeWarning('ATENÇÃO: 15 minutos restantes!');
                } else if (gameTime <= 1800) { // 30 minutos restantes - AMARELO
                    timeProgressElement.style.background = 'linear-gradient(90deg, #eab308, #ca8a04)';
                    timeRemainingElement.style.color = '#eab308';
                    timeRemainingElement.style.animation = 'none';
                } else { // Tempo normal - VERDE
                    timeProgressElement.style.background = 'linear-gradient(90deg, #22c55e, #16a34a)';
                    timeRemainingElement.style.color = '#22c55e';
                    timeRemainingElement.style.animation = 'none';
                }
                
                // Adicionar mensagem ao chat sobre tempo crítico
                if (gameTime === 300) { // Exatamente 5 minutos
                    addChatMessage("🚨 TEMPO CRÍTICO! Menos de 5 minutos restantes!", "Hotchner");
                } else if (gameTime === 900) { // Exatamente 15 minutos
                    addChatMessage("⚠️ ATENÇÃO: 15 minutos restantes!", "Morgan");
                } else if (gameTime === 1800) { // Exatamente 30 minutos
                    addChatMessage("⏰ 30 minutos restantes. Mantenha o foco!", "Reid");
                }
            }
        }

        // Função para mostrar aviso de tempo
        function showTimeWarning(message) {
            const warning = document.createElement('div');
            warning.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #dc2626, #991b1b);
                color: white;
                padding: 1rem 2rem;
                border-radius: 15px;
                font-weight: bold;
                font-size: 1.2rem;
                z-index: 3000;
                animation: timeWarningAnim 2s ease-out forwards;
                box-shadow: 0 10px 30px rgba(220, 38, 38, 0.5);
                text-align: center;
            `;
            warning.textContent = message;
            
            document.body.appendChild(warning);
            
            setTimeout(() => {
                warning.remove();
            }, 3000);
        }



        // Função para iniciar o intervalo do timer
        function startTimerInterval() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            isTimerRunning = true;
            timerInterval = setInterval(() => {
                if (gameTime > 0) {
                    gameTime--;
                    updateTimeDisplay();
                    
                    // Bônus por tempo (a cada minuto)
                    if (gameTime % 60 === 0 && gameTime > 0) {
                        const timeBonus = Math.floor(gameTime / 60) * 2; // 2 moedas por minuto restante
                        playerCoins += timeBonus;
                        document.getElementById('coin-display').textContent = playerCoins;
                        
                        // Adicionar mensagem ao chat sobre bônus de tempo
                        if (timeBonus > 0) {
                            addChatMessage(`💰 Bônus de tempo: +${timeBonus} moedas!`, "Garcia");
                        }
                    }
                } else {
                    // Tempo esgotado
                    clearInterval(timerInterval);
                    isTimerRunning = false;
                    
                    // Mostrar resultado final
                    showGameEndModal('timeout');
                    
                    // Adicionar mensagem ao chat
                    addChatMessage("⏰ TEMPO ESGOTADO! Investigação encerrada.", "Hotchner");
                }
            }, 1000);
        }

        // CSS Animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes cardPlayedAnim {
                0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
                50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
                100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
            }
            
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
            
            @keyframes pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.7; }
            }
            
            @keyframes timeWarningAnim {
                0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
                20% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
                80% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                100% { transform: translate(-50%, -50%) scale(0.9); opacity: 0; }
            }
            
            @keyframes timeCritical {
                0%, 100% { 
                    background: linear-gradient(90deg, #dc2626, #991b1b);
                    box-shadow: 0 0 20px rgba(220, 38, 38, 0.5);
                }
                50% { 
                    background: linear-gradient(90deg, #991b1b, #dc2626);
                    box-shadow: 0 0 30px rgba(220, 38, 38, 0.8);
                }
            }

            @keyframes cardGlow {
                0%, 100% {
                    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(251, 191, 36, 0.1);
                }
                50% {
                    box-shadow: 0 6px 20px rgba(251, 191, 36, 0.3), inset 0 1px 0 rgba(251, 191, 36, 0.2);
                }
            }

            @keyframes cardPulse {
                0%, 100% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.05);
                }
            }

            @keyframes cardShake {
                0%, 100% {
                    transform: translateX(0);
                }
                25% {
                    transform: translateX(-2px);
                }
                75% {
                    transform: translateX(2px);
                }
            }

            @keyframes cardFadeOut {
                0% {
                    opacity: 1;
                    transform: scale(1);
                }
                100% {
                    opacity: 0;
                    transform: scale(0.8);
                }
            }
        `;
        document.head.appendChild(style);

        // Recuperar dados do usuário
        window.onload = function() {
            const detectiveName = localStorage.getItem('detectiveName');
            if (detectiveName) {
                const teamList = document.getElementById('teamList');
                const userDiv = document.createElement('div');
                userDiv.className = 'chat-message';
                userDiv.innerHTML = `<span class="chat-user">🕵️ ${detectiveName}:</span> Online - 47 cartas`;
                teamList.appendChild(userDiv);
            }
            
            // Timer simples já está configurado para iniciar automaticamente
            console.log('⏱️ Timer simples configurado para iniciar automaticamente');
            
            // Garantir que o timer inicie quando a página carregar completamente
            if (!isTimerRunning) {
                console.log('⏱️ Iniciando timer no carregamento da página...');
                startTimerInterval();
                updateTimeDisplay();
            }
            
            // Inicializar sistema completo de testes e melhorias
            if (typeof ComprehensiveTestSystem !== 'undefined') {
                try {
                    window.comprehensiveTestSystem = new ComprehensiveTestSystem();
                    console.log('🧪 Sistema completo de testes e melhorias inicializado');
                } catch (error) {
                    console.error('Erro ao inicializar sistema de testes:', error);
                }
            }
            
            // Inicializar sistema aprimorado do jogo
            if (typeof EnhancedGameSystem !== 'undefined') {
                try {
                    window.enhancedGameSystem = new EnhancedGameSystem();
                    console.log('🎮 Sistema aprimorado do jogo inicializado');
                } catch (error) {
                    console.error('Erro ao inicializar sistema aprimorado:', error);
                }
            }
            
            // Inicializar sistema de mão completa
            if (typeof CompleteHandSystem !== 'undefined') {
                try {
                    window.completeHandSystem = new CompleteHandSystem();
                    console.log('🃏 Sistema de mão completa inicializado');
                } catch (error) {
                    console.error('Erro ao inicializar sistema de mão completa:', error);
                }
            }
            
            // Inicializar sistema de diagnóstico de layout PRIMEIRO
            if (typeof LayoutDiagnosticSystem !== 'undefined') {
                try {
                    window.layoutDiagnostic = new LayoutDiagnosticSystem();
                    console.log('🔍 Sistema de diagnóstico de layout inicializado');
                    
                    // Executar diagnóstico completo
            setTimeout(() => {
                        window.layoutDiagnostic.forceFixBasedOnDiagnostic();
                        window.layoutDiagnostic.runRealTimeDiagnostic();
                    }, 500);
                } catch (error) {
                    console.error('Erro ao inicializar sistema de diagnóstico:', error);
                }
            }

            // Desabilitado: AggressiveFixSystem estava limpando o DOM e causando loops
            // Caso necessário no futuro, reativar com muito cuidado
            
            // Inicializar sistema de correção de layout
            if (typeof LayoutFixSystem !== 'undefined') {
                try {
                    window.layoutFixSystem = new LayoutFixSystem();
                    console.log('🎨 Sistema de correção de layout inicializado');
                    
                    // Executar correção de layout
                    setTimeout(() => {
                        window.layoutFixSystem.run();
                    }, 2000);
                } catch (error) {
                    console.error('Erro ao inicializar sistema de correção de layout:', error);
                }
            }
            
            // Inicializar sistema de cartas interativas
            initializeCards();
            console.log('🃏 Sistema de cartas interativas inicializado');
            
            // Inicializar estatísticas
            updateStats();
            updateTimeDisplay();
            console.log('📊 Estatísticas inicializadas');
            
            // Inicializar chat da equipe
            initializeChat();
            console.log('💬 Chat da equipe inicializado');
        };
    </script>
</body>
</html>